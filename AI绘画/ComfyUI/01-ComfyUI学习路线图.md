---
title: ComfyUI å®Œæ•´å­¦ä¹ è·¯çº¿å›¾
date: 2025-12-03
tags:
  - ComfyUI
  - AIç»˜ç”»
  - Stable Diffusion
  - å­¦ä¹ è·¯çº¿
categories:
  - AIç»˜ç”»
---

# ComfyUI å®Œæ•´å­¦ä¹ è·¯çº¿å›¾

## ðŸ“š å­¦ä¹ è·¯çº¿æ¦‚è§ˆ

```mermaid
graph TD
    A[ComfyUI å­¦ä¹ èµ·ç‚¹] --> B[ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€å…¥é—¨]
    B --> C[ç¬¬äºŒé˜¶æ®µ: æ ¸å¿ƒèŠ‚ç‚¹æŽŒæ¡]
    C --> D[ç¬¬ä¸‰é˜¶æ®µ: å·¥ä½œæµæž„å»º]
    D --> E[ç¬¬å››é˜¶æ®µ: è¿›é˜¶æŠ€å·§]
    E --> F[ç¬¬äº”é˜¶æ®µ: é«˜çº§åº”ç”¨]
    F --> G[ç¬¬å…­é˜¶æ®µ: å®žæˆ˜é¡¹ç›®]

    B --> B1[çŽ¯å¢ƒæ­å»º]
    B --> B2[ç•Œé¢è®¤è¯†]
    B --> B3[åŸºç¡€æ¦‚å¿µ]

    C --> C1[æ¨¡åž‹èŠ‚ç‚¹]
    C --> C2[é‡‡æ ·èŠ‚ç‚¹]
    C --> C3[æ¡ä»¶èŠ‚ç‚¹]

    D --> D1[æ–‡ç”Ÿå›¾å·¥ä½œæµ]
    D --> D2[å›¾ç”Ÿå›¾å·¥ä½œæµ]
    D --> D3[ControlNetå·¥ä½œæµ]

    E --> E1[LoRAä½¿ç”¨]
    E --> E2[å¤šæ¨¡åž‹ç»„åˆ]
    E --> E3[æ‰¹é‡å¤„ç†]

    F --> F1[è‡ªå®šä¹‰èŠ‚ç‚¹]
    F --> F2[æ’ä»¶å¼€å‘]
    F --> F3[å·¥ä½œæµä¼˜åŒ–]

    G --> G1[å•†ä¸šé¡¹ç›®]
    G --> G2[åˆ›æ„è®¾è®¡]
    G --> G3[è‡ªåŠ¨åŒ–æµç¨‹]
```

## ðŸŽ¯ å­¦ä¹ ç›®æ ‡è®¾å®š

### åˆå­¦è€…ç›®æ ‡ (1-2å‘¨)
- âœ… æˆåŠŸå®‰è£…å¹¶è¿è¡Œ ComfyUI
- âœ… ç†è§£èŠ‚ç‚¹å¼å·¥ä½œæµçš„æ¦‚å¿µ
- âœ… èƒ½å¤Ÿä½¿ç”¨åŸºç¡€å·¥ä½œæµç”Ÿæˆå›¾ç‰‡
- âœ… æŽŒæ¡åŸºæœ¬çš„å‚æ•°è°ƒæ•´

### è¿›é˜¶è€…ç›®æ ‡ (1-2ä¸ªæœˆ)
- âœ… ç†Ÿç»ƒä½¿ç”¨å„ç±»æ ¸å¿ƒèŠ‚ç‚¹
- âœ… èƒ½å¤Ÿè‡ªå·±æ­å»ºå®Œæ•´å·¥ä½œæµ
- âœ… æŽŒæ¡ ControlNet ç­‰é«˜çº§æŽ§åˆ¶æŠ€æœ¯
- âœ… ç†è§£ LoRAã€Embedding ç­‰æ¨¡åž‹ä½¿ç”¨

### é«˜çº§è€…ç›®æ ‡ (3-6ä¸ªæœˆ)
- âœ… èƒ½å¤Ÿä¼˜åŒ–å·¥ä½œæµæ€§èƒ½
- âœ… å¼€å‘è‡ªå®šä¹‰èŠ‚ç‚¹å’Œæ’ä»¶
- âœ… æž„å»ºå¤æ‚çš„è‡ªåŠ¨åŒ–æµç¨‹
- âœ… åº”ç”¨äºŽå®žé™…å•†ä¸šé¡¹ç›®

---

## ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€å…¥é—¨ (1-2å‘¨)

### 1.1 çŽ¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, macOS, Linux
- **GPU**: NVIDIA æ˜¾å¡(æŽ¨è 6GB+ æ˜¾å­˜)
- **å†…å­˜**: 16GB+ RAM
- **å­˜å‚¨**: 50GB+ å¯ç”¨ç©ºé—´

#### å®‰è£…æ­¥éª¤
```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨ ComfyUI
python main.py
```

#### å…³é”®ç›®å½•ç»“æž„
```
ComfyUI/
â”œâ”€â”€ models/               # æ¨¡åž‹å­˜æ”¾ç›®å½•
â”‚   â”œâ”€â”€ checkpoints/     # ä¸»æ¨¡åž‹(SD/SDXL)
â”‚   â”œâ”€â”€ vae/             # VAE æ¨¡åž‹
â”‚   â”œâ”€â”€ loras/           # LoRA æ¨¡åž‹
â”‚   â”œâ”€â”€ embeddings/      # Embedding æ¨¡åž‹
â”‚   â””â”€â”€ controlnet/      # ControlNet æ¨¡åž‹
â”œâ”€â”€ input/               # è¾“å…¥å›¾ç‰‡ç›®å½•
â”œâ”€â”€ output/              # è¾“å‡ºå›¾ç‰‡ç›®å½•
â”œâ”€â”€ custom_nodes/        # è‡ªå®šä¹‰èŠ‚ç‚¹ç›®å½•
â””â”€â”€ web/                 # Web ç•Œé¢æ–‡ä»¶
```

### 1.2 ç•Œé¢è®¤è¯†

#### ä¸»è¦åŒºåŸŸåˆ’åˆ†
1. **å·¥ä½œåŒº (Canvas)**: èŠ‚ç‚¹ç¼–è¾‘çš„ä¸»è¦åŒºåŸŸ
2. **èŠ‚ç‚¹åº“ (Node Menu)**: å³é”®èœå•,åŒ…å«æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹
3. **é˜Ÿåˆ—é¢æ¿ (Queue)**: æ˜¾ç¤ºå¾…å¤„ç†å’Œæ­£åœ¨å¤„ç†çš„ä»»åŠ¡
4. **åŽ†å²è®°å½• (History)**: æŸ¥çœ‹ä¹‹å‰çš„ç”Ÿæˆè®°å½•

#### åŸºæœ¬æ“ä½œ
- **æ·»åŠ èŠ‚ç‚¹**: å³é”® â†’ é€‰æ‹©èŠ‚ç‚¹ç±»åž‹
- **è¿žæŽ¥èŠ‚ç‚¹**: æ‹–åŠ¨è¾“å‡ºç‚¹åˆ°è¾“å…¥ç‚¹
- **ç§»åŠ¨è§†å›¾**: é¼ æ ‡ä¸­é”®æ‹–åŠ¨
- **ç¼©æ”¾è§†å›¾**: é¼ æ ‡æ»šè½®
- **åˆ é™¤èŠ‚ç‚¹**: é€‰ä¸­èŠ‚ç‚¹ â†’ Delete é”®
- **å¤åˆ¶èŠ‚ç‚¹**: Ctrl+C / Ctrl+V

### 1.3 æ ¸å¿ƒæ¦‚å¿µç†è§£

#### èŠ‚ç‚¹ (Node)
- **å®šä¹‰**: æ‰§è¡Œç‰¹å®šåŠŸèƒ½çš„ç‹¬ç«‹å•å…ƒ
- **ç±»åž‹**: è¾“å…¥èŠ‚ç‚¹ã€å¤„ç†èŠ‚ç‚¹ã€è¾“å‡ºèŠ‚ç‚¹
- **å±žæ€§**: æ¯ä¸ªèŠ‚ç‚¹æœ‰è‡ªå·±çš„å‚æ•°é…ç½®

#### å·¥ä½œæµ (Workflow)
- **å®šä¹‰**: å¤šä¸ªèŠ‚ç‚¹æŒ‰ç‰¹å®šé¡ºåºè¿žæŽ¥å½¢æˆçš„å¤„ç†æµç¨‹
- **æ‰§è¡Œ**: ä»Žè¾“å…¥èŠ‚ç‚¹å¼€å§‹,ä¾æ¬¡æ‰§è¡Œåˆ°è¾“å‡ºèŠ‚ç‚¹
- **ä¿å­˜**: å¯å¯¼å‡ºä¸º JSON æ–‡ä»¶åˆ†äº«

#### æ•°æ®æµå‘
```mermaid
graph LR
    A[è¾“å…¥èŠ‚ç‚¹] --> B[å¤„ç†èŠ‚ç‚¹1]
    B --> C[å¤„ç†èŠ‚ç‚¹2]
    C --> D[è¾“å‡ºèŠ‚ç‚¹]

    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#fff4e1
    style D fill:#e8f5e9
```

### 1.4 ç¬¬ä¸€ä¸ªå·¥ä½œæµå®žè·µ

#### æœ€ç®€å•çš„æ–‡ç”Ÿå›¾å·¥ä½œæµ
```mermaid
graph LR
    A[Load Checkpoint] --> B[CLIP Text Encode]
    A --> C[CLIP Text Encode]
    A --> D[Empty Latent Image]
    B --> E[KSampler]
    C --> E
    D --> E
    A --> E
    E --> F[VAE Decode]
    F --> G[Save Image]

    B -.æ­£é¢æç¤ºè¯.-> B
    C -.è´Ÿé¢æç¤ºè¯.-> C
```

**éœ€è¦çš„èŠ‚ç‚¹:**
1. **Load Checkpoint**: åŠ è½½ä¸»æ¨¡åž‹
2. **CLIP Text Encode** (Ã—2): ç¼–ç æ­£é¢å’Œè´Ÿé¢æç¤ºè¯
3. **Empty Latent Image**: åˆ›å»ºç©ºç™½æ½œç©ºé—´å›¾åƒ
4. **KSampler**: é‡‡æ ·å™¨,æ ¸å¿ƒç”ŸæˆèŠ‚ç‚¹
5. **VAE Decode**: è§£ç æ½œç©ºé—´å›¾åƒ
6. **Save Image**: ä¿å­˜æœ€ç»ˆå›¾ç‰‡

**å‚æ•°é…ç½®:**
- **Checkpoint**: é€‰æ‹©ä¸‹è½½çš„æ¨¡åž‹
- **æ­£é¢æç¤ºè¯**: æè¿°æƒ³è¦ç”Ÿæˆçš„å†…å®¹
- **è´Ÿé¢æç¤ºè¯**: æè¿°ä¸æƒ³è¦çš„å†…å®¹
- **å›¾åƒå°ºå¯¸**: 512Ã—512 æˆ– 1024Ã—1024
- **é‡‡æ ·æ­¥æ•°**: 20-30 æ­¥
- **CFG Scale**: 7-9

---

## ç¬¬äºŒé˜¶æ®µ: æ ¸å¿ƒèŠ‚ç‚¹æŽŒæ¡ (2-3å‘¨)

### 2.1 åŠ è½½å™¨èŠ‚ç‚¹ (Loaders)

#### Load Checkpoint
- **åŠŸèƒ½**: åŠ è½½ä¸»æ¨¡åž‹
- **å…³é”®å‚æ•°**:
  - `ckpt_name`: æ¨¡åž‹æ–‡ä»¶å
- **è¾“å‡º**: MODEL, CLIP, VAE

#### Load LoRA
- **åŠŸèƒ½**: åŠ è½½ LoRA å¾®è°ƒæ¨¡åž‹
- **å…³é”®å‚æ•°**:
  - `lora_name`: LoRA æ–‡ä»¶å
  - `strength_model`: æ¨¡åž‹å¼ºåº¦ (0.0-1.0)
  - `strength_clip`: CLIP å¼ºåº¦ (0.0-1.0)

#### Load VAE
- **åŠŸèƒ½**: åŠ è½½ç‹¬ç«‹çš„ VAE æ¨¡åž‹
- **ä½¿ç”¨åœºæ™¯**: æŸäº›æ¨¡åž‹è‡ªå¸¦çš„ VAE æ•ˆæžœä¸ä½³æ—¶

### 2.2 æ¡ä»¶èŠ‚ç‚¹ (Conditioning)

#### CLIP Text Encode (Prompt)
- **åŠŸèƒ½**: å°†æ–‡æœ¬æç¤ºè¯ç¼–ç ä¸ºæ¡ä»¶å‘é‡
- **æç¤ºè¯æŠ€å·§**:
  - ä½¿ç”¨è‹±æ–‡é€—å·åˆ†éš”å…³é”®è¯
  - é‡è¦è¯æ±‡å¯åŠ æƒ: `(keyword:1.2)`
  - é™ä½Žæƒé‡: `(keyword:0.8)`

#### CLIP Text Encode (Prompt) Advanced
- **åŠŸèƒ½**: æ”¯æŒæ›´å¤æ‚çš„æç¤ºè¯è¯­æ³•
- **é«˜çº§è¯­æ³•**:
  ```
  (ä¸»ä½“:1.3), (é£Žæ ¼:1.1), çŽ¯å¢ƒæè¿°
  [ä¸æƒ³è¦çš„å…ƒç´ :-0.5]
  ```

### 2.3 é‡‡æ ·èŠ‚ç‚¹ (Sampling)

#### KSampler
- **åŠŸèƒ½**: æ ¸å¿ƒé‡‡æ ·å™¨,ç”Ÿæˆå›¾åƒ
- **å…³é”®å‚æ•°è¯¦è§£**:
  - **seed**: éšæœºç§å­ (å›ºå®šå¯å¤çŽ°)
  - **steps**: é‡‡æ ·æ­¥æ•° (20-50,è¶Šé«˜è´¨é‡è¶Šå¥½ä½†è¶Šæ…¢)
  - **cfg**: æç¤ºè¯ç›¸å…³æ€§ (7-15,è¶Šé«˜è¶Šç¬¦åˆæç¤ºè¯)
  - **sampler_name**: é‡‡æ ·ç®—æ³•
    - `euler`: å¿«é€Ÿ,é€‚åˆå¤§å¤šæ•°åœºæ™¯
    - `dpm++_2m`: é«˜è´¨é‡,æŽ¨è
    - `ddim`: ç¨³å®š,é€‚åˆå›¾ç”Ÿå›¾
  - **scheduler**: è°ƒåº¦å™¨
    - `normal`: æ ‡å‡†
    - `karras`: æ›´å¹³æ»‘çš„å™ªå£°æ›²çº¿
  - **denoise**: åŽ»å™ªå¼ºåº¦ (1.0=å®Œå…¨é‡ç»˜)

#### KSampler Advanced
- **é¢å¤–åŠŸèƒ½**:
  - æŽ§åˆ¶èµ·å§‹æ­¥æ•°å’Œç»“æŸæ­¥æ•°
  - æ”¯æŒåˆ†é˜¶æ®µé‡‡æ ·

### 2.4 æ½œç©ºé—´èŠ‚ç‚¹ (Latent)

#### Empty Latent Image
- **åŠŸèƒ½**: åˆ›å»ºç©ºç™½æ½œç©ºé—´å›¾åƒ
- **å¸¸ç”¨å°ºå¯¸**:
  - SD 1.5: 512Ã—512, 512Ã—768
  - SDXL: 1024Ã—1024, 1024Ã—1536

#### VAE Encode
- **åŠŸèƒ½**: å°†å›¾ç‰‡ç¼–ç ä¸ºæ½œç©ºé—´
- **ç”¨é€”**: å›¾ç”Ÿå›¾å·¥ä½œæµ

#### VAE Decode
- **åŠŸèƒ½**: å°†æ½œç©ºé—´è§£ç ä¸ºå›¾ç‰‡
- **ä½ç½®**: é‡‡æ ·å™¨ä¹‹åŽ,ä¿å­˜ä¹‹å‰

### 2.5 å›¾åƒå¤„ç†èŠ‚ç‚¹ (Image Processing)

#### Load Image
- **åŠŸèƒ½**: ä»Ž input ç›®å½•åŠ è½½å›¾ç‰‡
- **æ”¯æŒæ ¼å¼**: PNG, JPG, WebP

#### Save Image
- **åŠŸèƒ½**: ä¿å­˜ç”Ÿæˆçš„å›¾ç‰‡
- **å‚æ•°**:
  - `filename_prefix`: æ–‡ä»¶åå‰ç¼€

#### Image Scale
- **åŠŸèƒ½**: ç¼©æ”¾å›¾ç‰‡å°ºå¯¸
- **ç®—æ³•é€‰æ‹©**:
  - `nearest`: æœ€è¿‘é‚»(å¿«é€Ÿ)
  - `bilinear`: åŒçº¿æ€§(å¹³è¡¡)
  - `lanczos`: å…°ç´¢æ–¯(é«˜è´¨é‡)

---

## ç¬¬ä¸‰é˜¶æ®µ: å·¥ä½œæµæž„å»º (3-4å‘¨)

### 3.1 æ ‡å‡†æ–‡ç”Ÿå›¾å·¥ä½œæµ

#### åŸºç¡€ç‰ˆæœ¬
```mermaid
graph TB
    A[Load Checkpoint] --> B[æ­£é¢æç¤ºè¯]
    A --> C[è´Ÿé¢æç¤ºè¯]
    A --> D[Empty Latent]

    B --> E[KSampler]
    C --> E
    D --> E
    A --> E

    E --> F[VAE Decode]
    F --> G[Save Image]
```

#### è¿›é˜¶ç‰ˆæœ¬ (åŠ å…¥ LoRA)
```mermaid
graph TB
    A[Load Checkpoint] --> B[Load LoRA]
    B --> C[æ­£é¢æç¤ºè¯]
    B --> D[è´Ÿé¢æç¤ºè¯]
    B --> E[Empty Latent]

    C --> F[KSampler]
    D --> F
    E --> F
    B --> F

    F --> G[VAE Decode]
    G --> H[Save Image]
```

### 3.2 å›¾ç”Ÿå›¾å·¥ä½œæµ

#### åŸºç¡€å›¾ç”Ÿå›¾
```mermaid
graph TB
    A[Load Image] --> B[VAE Encode]
    C[Load Checkpoint] --> D[æ­£é¢æç¤ºè¯]
    C --> E[è´Ÿé¢æç¤ºè¯]

    D --> F[KSampler]
    E --> F
    B --> F
    C --> F

    F --> G[VAE Decode]
    G --> H[Save Image]
```

**å…³é”®ç‚¹:**
- `denoise` å‚æ•°æŽ§åˆ¶é‡ç»˜å¼ºåº¦
  - 0.3-0.5: è½»å¾®è°ƒæ•´
  - 0.5-0.7: ä¸­ç­‰ä¿®æ”¹
  - 0.7-1.0: å¤§å¹…é‡ç»˜

### 3.3 ControlNet å·¥ä½œæµ

#### Canny è¾¹ç¼˜æŽ§åˆ¶
```mermaid
graph TB
    A[Load Image] --> B[Canny Edge]
    C[Load Checkpoint] --> D[Load ControlNet]
    B --> E[Apply ControlNet]
    D --> E

    F[æ­£é¢æç¤ºè¯] --> G[KSampler]
    H[è´Ÿé¢æç¤ºè¯] --> G
    I[Empty Latent] --> G
    E --> G
    C --> G

    G --> J[VAE Decode]
    J --> K[Save Image]
```

#### å¸¸ç”¨ ControlNet ç±»åž‹
1. **Canny**: è¾¹ç¼˜æ£€æµ‹,ä¿æŒç»“æž„
2. **Depth**: æ·±åº¦å›¾,ä¿æŒç©ºé—´å…³ç³»
3. **OpenPose**: å§¿æ€æŽ§åˆ¶,äººç‰©ç”Ÿæˆ
4. **Scribble**: æ¶‚é¸¦æŽ§åˆ¶,å¿«é€Ÿè‰å›¾
5. **Lineart**: çº¿ç¨¿æŽ§åˆ¶,æ’ç”»é£Žæ ¼

### 3.4 é«˜æ¸…ä¿®å¤å·¥ä½œæµ (Hires.fix)

```mermaid
graph TB
    A[ç¬¬ä¸€é˜¶æ®µ: ä½Žåˆ†è¾¨çŽ‡ç”Ÿæˆ] --> B[Upscale Latent]
    B --> C[ç¬¬äºŒé˜¶æ®µ: é«˜åˆ†è¾¨çŽ‡ç²¾ä¿®]
    C --> D[æœ€ç»ˆè¾“å‡º]

    A1[512x512] --> B
    B --> C1[1024x1024]
```

**æµç¨‹è¯´æ˜Ž:**
1. å…ˆç”Ÿæˆä½Žåˆ†è¾¨çŽ‡å›¾ç‰‡ (512Ã—512)
2. æ”¾å¤§æ½œç©ºé—´å›¾åƒ (Upscale Latent)
3. ä½Ž denoise å€¼é‡æ–°é‡‡æ · (0.4-0.6)
4. å¾—åˆ°é«˜è´¨é‡å¤§å›¾

---

## ç¬¬å››é˜¶æ®µ: è¿›é˜¶æŠ€å·§ (1-2ä¸ªæœˆ)

### 4.1 LoRA ä½¿ç”¨æŠ€å·§

#### LoRA å åŠ ä½¿ç”¨
```java
// å¤šä¸ª LoRA ç»„åˆç¤ºä¾‹
Load Checkpoint (åŸºç¡€æ¨¡åž‹)
  â†“
Load LoRA 1 (é£Žæ ¼ LoRA, strength: 0.8)
  â†“
Load LoRA 2 (äººç‰© LoRA, strength: 0.6)
  â†“
Load LoRA 3 (ç»†èŠ‚ LoRA, strength: 0.4)
  â†“
CLIP Text Encode (æç¤ºè¯)
```

**å åŠ åŽŸåˆ™:**
- æœ€å¤šå åŠ  3-4 ä¸ª LoRA
- æƒé‡æ€»å’Œå»ºè®®ä¸è¶…è¿‡ 2.0
- é£Žæ ¼ç±» LoRA æ”¾å‰é¢,ç»†èŠ‚ç±»æ”¾åŽé¢

#### LoRA å¼ºåº¦è°ƒèŠ‚ç­–ç•¥
- **0.2-0.4**: è½»å¾®å½±å“,ä¿ç•™åŸºç¡€æ¨¡åž‹ç‰¹å¾
- **0.5-0.7**: ä¸­ç­‰å½±å“,å¹³è¡¡æ•ˆæžœ
- **0.8-1.0**: å¼ºçƒˆå½±å“,çªå‡º LoRA ç‰¹å¾
- **>1.0**: è¿‡åº¦å½±å“,å¯èƒ½å‡ºçŽ°å¼‚å¸¸

### 4.2 æ‰¹é‡ç”ŸæˆæŠ€å·§

#### æ‰¹é‡ç”Ÿæˆä¸åŒæç¤ºè¯
```mermaid
graph LR
    A[æç¤ºè¯åˆ—è¡¨] --> B[å¾ªçŽ¯èŠ‚ç‚¹]
    B --> C[ç”ŸæˆèŠ‚ç‚¹]
    C --> D[æ‰¹é‡ä¿å­˜]
```

#### æ‰¹é‡ç”Ÿæˆä¸åŒå‚æ•°
- ä½¿ç”¨ **Primitive** èŠ‚ç‚¹åˆ›å»ºå‚æ•°åˆ—è¡¨
- è¿žæŽ¥åˆ° **å¾ªçŽ¯æŽ§åˆ¶èŠ‚ç‚¹**
- è‡ªåŠ¨éåŽ†æ‰€æœ‰å‚æ•°ç»„åˆ

### 4.3 é¢éƒ¨ä¿®å¤æŠ€å·§

#### ä½¿ç”¨ Face Restore èŠ‚ç‚¹
```mermaid
graph LR
    A[ç”Ÿæˆçš„å›¾ç‰‡] --> B[æ£€æµ‹äººè„¸]
    B --> C[Face Restore]
    C --> D[Blend èžåˆ]
    A --> D
    D --> E[æœ€ç»ˆå›¾ç‰‡]
```

**æŽ¨èæ¨¡åž‹:**
- **CodeFormer**: ä¿®å¤å¼ºåº¦å¯è°ƒ
- **GFPGAN**: ä¿®å¤æ•ˆæžœè‡ªç„¶

### 4.4 å±€éƒ¨é‡ç»˜ (Inpainting)

#### å·¥ä½œæµç»“æž„
```mermaid
graph TB
    A[åŽŸå›¾] --> B[Mask é®ç½©]
    A --> C[VAE Encode]
    B --> D[Inpaint]
    C --> D

    E[æç¤ºè¯] --> D
    F[KSampler] --> D
    D --> G[VAE Decode]
    G --> H[åˆæˆæœ€ç»ˆå›¾]
```

**åº”ç”¨åœºæ™¯:**
- æ›¿æ¢å›¾ç‰‡ä¸­çš„ç‰¹å®šå…ƒç´ 
- ä¿®å¤å›¾ç‰‡ç‘•ç–µ
- æ‰©å±•å›¾ç‰‡è¾¹ç•Œ (Outpainting)

### 4.5 æç¤ºè¯å·¥ç¨‹è¿›é˜¶

#### åˆ†å±‚æç¤ºè¯ç»“æž„
```
# ä¸»ä½“å±‚ (æƒé‡ 1.2-1.5)
(ä¸»è¦è§’è‰²æˆ–ç‰©ä½“:1.3)

# é£Žæ ¼å±‚ (æƒé‡ 1.0-1.2)
(è‰ºæœ¯é£Žæ ¼, æ¸²æŸ“æ–¹å¼:1.1)

# çŽ¯å¢ƒå±‚ (æƒé‡ 0.8-1.0)
èƒŒæ™¯, å…‰ç…§, æ°›å›´

# è´¨é‡å±‚ (æƒé‡ 1.0)
masterpiece, best quality, highly detailed

# è´Ÿé¢å±‚
(ä½Žè´¨é‡å…ƒç´ , ä¸æƒ³è¦çš„å†…å®¹:1.2)
```

#### æç¤ºè¯æ¨¡æ¿ç¤ºä¾‹
```
# äººç‰©è‚–åƒæ¨¡æ¿
(1girl:1.2), (realistic:1.1), (portrait:1.2),
detailed face, beautiful eyes,
soft lighting, bokeh background,
masterpiece, best quality, 8k

# é£Žæ™¯æ¨¡æ¿
(landscape:1.3), (natural scenery:1.2),
mountain, lake, sunset,
volumetric lighting, cinematic,
ultra detailed, 4k wallpaper
```

---

## ç¬¬äº”é˜¶æ®µ: é«˜çº§åº”ç”¨ (2-3ä¸ªæœˆ)

### 5.1 è‡ªå®šä¹‰èŠ‚ç‚¹å¼€å‘

#### èŠ‚ç‚¹å¼€å‘åŸºç¡€
```java
// Python è‡ªå®šä¹‰èŠ‚ç‚¹ç¤ºä¾‹
class MyCustomNode:
    @classmethod
    def INPUT_TYPES(cls):
        return {
            "required": {
                "image": ("IMAGE",),
                "strength": ("FLOAT", {
                    "default": 1.0,
                    "min": 0.0,
                    "max": 2.0,
                    "step": 0.1
                })
            }
        }

    RETURN_TYPES = ("IMAGE",)
    FUNCTION = "process"
    CATEGORY = "image/processing"

    def process(self, image, strength):
        # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        processed = self.custom_logic(image, strength)
        return (processed,)
```

#### å¸¸è§è‡ªå®šä¹‰èŠ‚ç‚¹ç±»åž‹
1. **å›¾åƒå¤„ç†èŠ‚ç‚¹**: æ»¤é•œã€ç‰¹æ•ˆ
2. **å·¥ä½œæµæŽ§åˆ¶èŠ‚ç‚¹**: å¾ªçŽ¯ã€æ¡ä»¶åˆ¤æ–­
3. **æ¨¡åž‹åŠ è½½èŠ‚ç‚¹**: è‡ªå®šä¹‰æ¨¡åž‹æ ¼å¼
4. **æ•°æ®è½¬æ¢èŠ‚ç‚¹**: æ ¼å¼è½¬æ¢ã€å‚æ•°æ˜ å°„

### 5.2 æ’ä»¶ç”Ÿæ€

#### å¿…è£…æ’ä»¶æŽ¨è

**ComfyUI Manager**
- åŠŸèƒ½: ä¸€é”®å®‰è£…å’Œç®¡ç†å…¶ä»–æ’ä»¶
- åœ°å€: https://github.com/ltdrdata/ComfyUI-Manager

**Efficiency Nodes**
- åŠŸèƒ½: ä¼˜åŒ–çš„é«˜æ•ˆèŠ‚ç‚¹åŒ…
- ç‰¹ç‚¹: å‡å°‘èŠ‚ç‚¹æ•°é‡,ç®€åŒ–å·¥ä½œæµ

**Impact Pack**
- åŠŸèƒ½: é¢éƒ¨æ£€æµ‹å’Œä¿®å¤å·¥å…·åŒ…
- åº”ç”¨: äººç‰©ç”ŸæˆåŽå¤„ç†

**Inspire Pack**
- åŠŸèƒ½: åˆ›æ„è¾…åŠ©å·¥å…·
- ç‰¹ç‚¹: æç¤ºè¯ç”Ÿæˆã€é£Žæ ¼æ··åˆ

### 5.3 å·¥ä½œæµä¼˜åŒ–

#### æ€§èƒ½ä¼˜åŒ–æŠ€å·§

**1. æ¨¡åž‹åŠ è½½ä¼˜åŒ–**
```java
// ä½¿ç”¨æ¨¡åž‹ç¼“å­˜
Load Checkpoint (keep_in_memory: true)
  â†“
å¤šæ¬¡ä½¿ç”¨åŒä¸€æ¨¡åž‹,ä¸é‡å¤åŠ è½½
```

**2. æ‰¹é‡å¤„ç†ä¼˜åŒ–**
- ä½¿ç”¨ Batch èŠ‚ç‚¹åˆå¹¶å¤šå¼ å›¾
- ä¸€æ¬¡æ€§å¤„ç†,å‡å°‘å¼€é”€

**3. å†…å­˜ç®¡ç†**
- åŠæ—¶æ¸…ç†ä¸ç”¨çš„ä¸­é—´ç»“æžœ
- ä½¿ç”¨ä½Ž VRAM æ¨¡å¼ (é€Ÿåº¦æ¢æ˜¾å­˜)

#### å·¥ä½œæµå¤ç”¨ç­–ç•¥

**æ¨¡å—åŒ–è®¾è®¡**
```mermaid
graph TB
    A[åŸºç¡€æ¨¡å—] --> B[é£Žæ ¼æ¨¡å—]
    B --> C[åŽå¤„ç†æ¨¡å—]

    A1[æ¨¡åž‹åŠ è½½] --> A
    B1[LoRAåº”ç”¨] --> B
    C1[æ”¾å¤§ä¿®å¤] --> C
```

**å·¥ä½œæµæ¨¡æ¿åº“**
- æ–‡ç”Ÿå›¾æ¨¡æ¿
- å›¾ç”Ÿå›¾æ¨¡æ¿
- ControlNet æ¨¡æ¿
- æ‰¹é‡å¤„ç†æ¨¡æ¿

### 5.4 AI è§†é¢‘ç”Ÿæˆ (AnimateDiff)

#### AnimateDiff å·¥ä½œæµ
```mermaid
graph TB
    A[Load AnimateDiff Model] --> B[Prompt]
    A --> C[Empty Latent Video]
    B --> D[KSampler Video]
    C --> D
    D --> E[VAE Decode Video]
    E --> F[Save Video]
```

**å…³é”®å‚æ•°:**
- **frame_count**: å¸§æ•° (16, 24, 32)
- **fps**: å¸§çŽ‡ (8, 12, 16)
- **motion_scale**: è¿åŠ¨å¹…åº¦

---

## ç¬¬å…­é˜¶æ®µ: å®žæˆ˜é¡¹ç›® (æŒç»­å­¦ä¹ )

### 6.1 å•†ä¸šåº”ç”¨åœºæ™¯

#### ç”µå•†äº§å“å›¾ç”Ÿæˆ
**éœ€æ±‚åˆ†æž:**
- æ‰¹é‡ç”Ÿæˆå¤šè§’åº¦äº§å“å›¾
- ç»Ÿä¸€é£Žæ ¼å’ŒèƒŒæ™¯
- å¿«é€Ÿè¿­ä»£ä¿®æ”¹

**å·¥ä½œæµè®¾è®¡:**
```mermaid
graph LR
    A[äº§å“ç™½åº•å›¾] --> B[èƒŒæ™¯æ›¿æ¢]
    B --> C[é£Žæ ¼ç»Ÿä¸€]
    C --> D[æ‰¹é‡è¾“å‡º]
```

#### ç¤¾äº¤åª’ä½“å†…å®¹åˆ›ä½œ
**åº”ç”¨ç±»åž‹:**
- å¤´åƒç”Ÿæˆ
- å°é¢è®¾è®¡
- è¡¨æƒ…åŒ…åˆ¶ä½œ
- ä¹å®«æ ¼å›¾é›†

### 6.2 åˆ›æ„è®¾è®¡é¡¹ç›®

#### æ¦‚å¿µè‰ºæœ¯è®¾è®¡
```mermaid
graph TB
    A[è‰å›¾è¾“å…¥] --> B[ControlNet Scribble]
    B --> C[é£Žæ ¼æŽ¢ç´¢]
    C --> D[ç»†èŠ‚å®Œå–„]
    D --> E[é«˜æ¸…è¾“å‡º]
```

#### è§’è‰²è®¾è®¡æµç¨‹
1. **æ¦‚å¿µé˜¶æ®µ**: æ–‡å­—æè¿° â†’ åˆæ­¥ç”Ÿæˆ
2. **è¿­ä»£é˜¶æ®µ**: å›¾ç”Ÿå›¾ â†’ ç»†èŠ‚è°ƒæ•´
3. **å®šç¨¿é˜¶æ®µ**: å±€éƒ¨é‡ç»˜ â†’ é«˜æ¸…æ”¾å¤§
4. **åº”ç”¨é˜¶æ®µ**: å¤šè§’åº¦ â†’ è¡¨æƒ…å˜åŒ–

### 6.3 è‡ªåŠ¨åŒ–å·¥ä½œæµ

#### API é›†æˆ
```java
// ComfyUI API è°ƒç”¨ç¤ºä¾‹
import requests
import json

def generate_image(prompt, negative_prompt):
    workflow = {
        "prompt": prompt,
        "negative_prompt": negative_prompt,
        "steps": 30,
        "cfg": 7.5
    }

    response = requests.post(
        "http://localhost:8188/api/generate",
        json={"workflow": workflow}
    )

    return response.json()
```

#### æ‰¹é‡ä»»åŠ¡è°ƒåº¦
- ä½¿ç”¨é˜Ÿåˆ—ç³»ç»Ÿç®¡ç†å¤§é‡ä»»åŠ¡
- è‡ªåŠ¨ç›‘æŽ§ç”Ÿæˆè¿›åº¦
- å¤±è´¥ä»»åŠ¡è‡ªåŠ¨é‡è¯•

---

## ðŸ“– å­¦ä¹ èµ„æºæŽ¨è

### å®˜æ–¹èµ„æº
- **GitHub**: https://github.com/comfyanonymous/ComfyUI
- **Wiki**: https://github.com/comfyanonymous/ComfyUI/wiki
- **Discord**: ComfyUI å®˜æ–¹ç¤¾åŒº

### ä¸­æ–‡æ•™ç¨‹
- **Bç«™**: æœç´¢ "ComfyUI æ•™ç¨‹"
- **çŸ¥ä¹Ž**: ComfyUI ä¸“æ 
- **Reddit**: r/comfyui

### å·¥ä½œæµåˆ†äº«å¹³å°
- **OpenArt**: https://openart.ai/workflows
- **CivitAI**: https://civitai.com/

### æ¨¡åž‹ä¸‹è½½ç«™
- **CivitAI**: https://civitai.com/
- **HuggingFace**: https://huggingface.co/
- **LiblibAI**: https://www.liblib.art/

---

## ðŸŽ“ å­¦ä¹ å»ºè®®

### å­¦ä¹ æ–¹æ³•
1. **å®žè·µä¼˜å…ˆ**: æ¯å­¦ä¸€ä¸ªæ¦‚å¿µç«‹å³åŠ¨æ‰‹å°è¯•
2. **å¾ªåºæ¸è¿›**: ä»Žç®€å•å·¥ä½œæµå¼€å§‹,é€æ­¥å¢žåŠ å¤æ‚åº¦
3. **æ‹†è§£å­¦ä¹ **: ä¸‹è½½åˆ«äººçš„å·¥ä½œæµ,ç ”ç©¶æ¯ä¸ªèŠ‚ç‚¹çš„ä½œç”¨
4. **è®°å½•æ€»ç»“**: å»ºç«‹è‡ªå·±çš„å·¥ä½œæµæ¨¡æ¿åº“
5. **ç¤¾åŒºäº¤æµ**: åŠ å…¥ç¤¾åŒº,åˆ†äº«ç»éªŒ,è§£å†³é—®é¢˜

### å¸¸è§é—®é¢˜è§£å†³

#### æ˜¾å­˜ä¸è¶³ (CUDA out of memory)
**è§£å†³æ–¹æ¡ˆ:**
- é™ä½Žå›¾ç‰‡åˆ†è¾¨çŽ‡
- å‡å°‘æ‰¹é‡å¤„ç†æ•°é‡
- å¯ç”¨ `--lowvram` å¯åŠ¨å‚æ•°
- ä½¿ç”¨ fp16 æˆ– fp8 é‡åŒ–æ¨¡åž‹

#### ç”Ÿæˆé€Ÿåº¦æ…¢
**ä¼˜åŒ–æ–¹æ³•:**
- ä½¿ç”¨æ›´å¿«çš„é‡‡æ ·å™¨ (euler, dpmpp_2m)
- å‡å°‘é‡‡æ ·æ­¥æ•° (20-25 æ­¥)
- å‡çº§ CUDA å’Œ PyTorch ç‰ˆæœ¬
- æ£€æŸ¥ xformers æ˜¯å¦æ­£ç¡®å®‰è£…

#### å›¾ç‰‡è´¨é‡ä¸ç†æƒ³
**æ”¹è¿›æ€è·¯:**
- ä¼˜åŒ–æç¤ºè¯æè¿°
- è°ƒæ•´ CFG å€¼ (7-11)
- æ›´æ¢æ›´é«˜è´¨é‡çš„æ¨¡åž‹
- ä½¿ç”¨é«˜æ¸…ä¿®å¤å·¥ä½œæµ

---

## ðŸš€ è¿›é˜¶æ–¹å‘

### ä¸“ä¸šåŒ–æ–¹å‘

#### äººç‰©è‚–åƒä¸“ç²¾
- ç ”ç©¶å„ç±»äººç‰© LoRA
- æŽŒæ¡é¢éƒ¨ç‰¹å¾æŽ§åˆ¶
- å­¦ä¹ è¡¨æƒ…å’Œå§¿æ€ç”Ÿæˆ

#### åœºæ™¯è®¾è®¡ä¸“ç²¾
- å­¦ä¹ å»ºç­‘å’ŒçŽ¯å¢ƒè®¾è®¡
- æŽŒæ¡å…‰ç…§å’Œæ°›å›´è¥é€ 
- ç ”ç©¶æ¦‚å¿µè‰ºæœ¯é£Žæ ¼

#### è§†é¢‘ç”Ÿæˆä¸“ç²¾
- æ·±å…¥å­¦ä¹  AnimateDiff
- ç ”ç©¶è¿åŠ¨æŽ§åˆ¶æŠ€æœ¯
- æŽ¢ç´¢è§†é¢‘åŽå¤„ç†

### æŠ€æœ¯æ·±åŒ–æ–¹å‘

#### ç®—æ³•ç ”ç©¶
- ç ”ç©¶ä¸åŒé‡‡æ ·ç®—æ³•åŽŸç†
- ç†è§£ ControlNet æŠ€æœ¯ç»†èŠ‚
- å­¦ä¹ æ‰©æ•£æ¨¡åž‹æ•°å­¦åŸºç¡€

#### å·¥å…·å¼€å‘
- å¼€å‘è‡ªå®šä¹‰èŠ‚ç‚¹
- åˆ›å»ºæ’ä»¶å’Œæ‰©å±•
- æž„å»ºè‡ªåŠ¨åŒ–å·¥å…·é“¾

---

## ðŸ“ æ€»ç»“

ComfyUI çš„å­¦ä¹ æ˜¯ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹,ä»ŽåŸºç¡€æ“ä½œåˆ°é«˜çº§åº”ç”¨,éœ€è¦æŒç»­çš„å®žè·µå’ŒæŽ¢ç´¢ã€‚å…³é”®æ˜¯:

1. **æ‰“å¥½åŸºç¡€**: ç†è§£èŠ‚ç‚¹å’Œå·¥ä½œæµçš„æ ¸å¿ƒæ¦‚å¿µ
2. **å¤šåšå®žè·µ**: æ¯å¤©å°è¯•æž„å»ºæ–°çš„å·¥ä½œæµ
3. **å­¦ä¹ å€Ÿé‰´**: ç ”ç©¶ä¼˜ç§€çš„å·¥ä½œæµæ¡ˆä¾‹
4. **æŒç»­æ›´æ–°**: å…³æ³¨æ–°åŠŸèƒ½å’Œæ–°æ¨¡åž‹
5. **ç¤¾åŒºäº¤æµ**: åˆ†äº«ç»éªŒ,å…±åŒè¿›æ­¥

é€šè¿‡ç³»ç»Ÿçš„å­¦ä¹ å’Œä¸æ–­çš„å®žè·µ,ä½ å°†èƒ½å¤Ÿç†Ÿç»ƒæŽŒæ¡ ComfyUI,åˆ›ä½œå‡ºä»¤äººæƒŠè‰³çš„ AI è‰ºæœ¯ä½œå“!

---

> **ä¸‹ä¸€æ­¥**: å¼€å§‹ [ComfyUI åŸºç¡€å…¥é—¨å®žæˆ˜](./02-ComfyUIåŸºç¡€å…¥é—¨å®žæˆ˜.md)

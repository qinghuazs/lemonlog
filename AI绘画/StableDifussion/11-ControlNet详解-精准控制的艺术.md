---
title: ControlNet è¯¦è§£ - ç²¾å‡†æ§åˆ¶çš„è‰ºæœ¯
date: 2025-12-04
tags:
  - Stable Diffusion
  - ControlNet
  - ç²¾å‡†æ§åˆ¶
  - AIç»˜ç”»
categories:
  - AIç»˜ç”»
---

# ControlNet è¯¦è§£ - ç²¾å‡†æ§åˆ¶çš„è‰ºæœ¯

## ğŸ¯ ä»€ä¹ˆæ˜¯ ControlNetï¼Ÿ

**ControlNet** æ˜¯ Stable Diffusion æœ€å¼ºå¤§çš„æ§åˆ¶æ’ä»¶ï¼Œé€šè¿‡é¢„å¤„ç†å‚è€ƒå›¾åƒæå–ç»“æ„ä¿¡æ¯ï¼ˆå¦‚è¾¹ç¼˜ã€æ·±åº¦ã€å§¿åŠ¿ç­‰ï¼‰ï¼Œç²¾å‡†æ§åˆ¶ AI ç”Ÿæˆå›¾åƒçš„æ„å›¾ã€å§¿æ€å’Œå¸ƒå±€ï¼Œè§£å†³äº† AI ç»˜ç”»"éš¾ä»¥ç²¾ç¡®æ§åˆ¶"çš„æ ¸å¿ƒç—›ç‚¹ã€‚

### é©å‘½æ€§çªç ´

```mermaid
graph TB
    subgraph "ä¼ ç»Ÿæ–‡ç”Ÿå›¾"
        A1[æç¤ºè¯:<br/>a girl standing] --> B1[AIè‡ªç”±å‘æŒ¥]
        B1 --> C1[å§¿åŠ¿éšæœº<br/>æ„å›¾ä¸å¯æ§]
    end

    subgraph "ControlNet æ–‡ç”Ÿå›¾"
        A2[æç¤ºè¯:<br/>a girl standing] --> B2[ControlNet]
        D2[å‚è€ƒå§¿åŠ¿å›¾] --> B2
        B2 --> C2[ä¸¥æ ¼éµå¾ª<br/>å§¿åŠ¿å’Œæ„å›¾]
    end

    style C1 fill:#ff6b6b
    style C2 fill:#5cb85c
```

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- ğŸ¯ **å§¿åŠ¿æ§åˆ¶**ï¼šè®©è§’è‰²åšæŒ‡å®šåŠ¨ä½œ
- ğŸ“ **æ„å›¾æ§åˆ¶**ï¼šç²¾ç¡®å¤åˆ»ç…§ç‰‡æ„å›¾
- ğŸ—ï¸ **ç»“æ„æ§åˆ¶**ï¼šä¿æŒå»ºç­‘ã€åœºæ™¯å¸ƒå±€
- ğŸ¨ **åˆ›ä½œè‡ªç”±**ï¼šæ§åˆ¶ç»“æ„ + è‡ªç”±é£æ ¼

---

## ğŸ”¬ å·¥ä½œåŸç†

### æŠ€æœ¯æ¶æ„

```mermaid
sequenceDiagram
    participant R as å‚è€ƒå›¾
    participant P as é¢„å¤„ç†å™¨
    participant C as ControlNet
    participant SD as SDæ¨¡å‹
    participant O as è¾“å‡ºå›¾

    R->>P: ä¸Šä¼ å‚è€ƒå›¾
    Note over P: Canny/Depth/Pose<br/>æå–æ§åˆ¶ä¿¡æ¯
    P->>C: æ§åˆ¶å›¾
    Note over C: ç»“æ„æ¡ä»¶<br/>Condition Map
    C->>SD: æ³¨å…¥æ§åˆ¶ä¿¡æ¯
    Note over SD: ç”Ÿæˆæ—¶éµå¾ª<br/>ç»“æ„çº¦æŸ
    SD->>O: æœ€ç»ˆå›¾åƒ
    Note over O: ä¿æŒç»“æ„<br/>ç¬¦åˆæç¤ºè¯
```

### æ ¸å¿ƒæ¦‚å¿µ

```java
// ControlNet å·¥ä½œæµç¨‹
æ­¥éª¤1: é¢„å¤„ç†å™¨ (Preprocessor)
  è¾“å…¥: å‚è€ƒå›¾ (å¦‚çœŸäººç…§ç‰‡)
  å¤„ç†: æå–ç‰¹å®šä¿¡æ¯ (å¦‚äººä½“å§¿åŠ¿)
  è¾“å‡º: æ§åˆ¶å›¾ (éª¨æ¶ã€è¾¹ç¼˜ã€æ·±åº¦ç­‰)

æ­¥éª¤2: ControlNet æ¨¡å‹
  æ¥æ”¶: æ§åˆ¶å›¾ + åŸå§‹æç¤ºè¯
  ä½œç”¨: å°†æ§åˆ¶ä¿¡æ¯æ³¨å…¥ SD ç”Ÿæˆè¿‡ç¨‹
  æ•ˆæœ: å¼•å¯¼ AI æŒ‰æ§åˆ¶å›¾ç”Ÿæˆ

æ­¥éª¤3: Stable Diffusion
  åŸºäº: æç¤ºè¯ + ControlNet çº¦æŸ
  ç”Ÿæˆ: ç¬¦åˆç»“æ„çš„åˆ›æ„å†…å®¹
```

---

## ğŸ“Š ControlNet æ¨¡å‹ç±»å‹

### æ ¸å¿ƒæ¨¡å‹åˆ†ç±»

```mermaid
mindmap
  root((ControlNet<br/>æ¨¡å‹))
    è¾¹ç¼˜æ£€æµ‹
      Canny
        çº¿ç¨¿é£æ ¼
        ç²¾ç¡®è¾¹ç¼˜
      Lineart
        åŠ¨æ¼«çº¿ç¨¿
        æŸ”å’Œçº¿æ¡
      Scribble
        æ¶‚é¸¦è‰å›¾
        å¿«é€Ÿåˆ›ä½œ
    æ·±åº¦ä¸ç«‹ä½“
      Depth
        3Dç©ºé—´
        æ™¯æ·±æ§åˆ¶
      Normal
        æ³•çº¿è´´å›¾
        å…‰å½±ç»†èŠ‚
    äººä½“æ§åˆ¶
      OpenPose
        éª¨æ¶æ£€æµ‹
        å§¿åŠ¿æ§åˆ¶
      DWPose
        ç²¾å‡†æ‰‹éƒ¨
        é«˜çº§å§¿åŠ¿
    åˆ†å‰²ä¸åŒºåŸŸ
      Seg
        è¯­ä¹‰åˆ†å‰²
        åŒºåŸŸæ§åˆ¶
      Shuffle
        è‰²å—æ‰“ä¹±
        ä¿ç•™å¸ƒå±€
    ç‰¹æ®Šæ•ˆæœ
      Tile
        ç»†èŠ‚å¢å¼º
        æ— æŸæ”¾å¤§
      Reference
        å‚è€ƒå›¾
        é£æ ¼è¿ç§»
```

---

## ğŸ¨ æ ¸å¿ƒæ¨¡å‹è¯¦è§£

### 1. Cannyï¼ˆè¾¹ç¼˜æ£€æµ‹ï¼‰â­ æœ€å¸¸ç”¨

```java
// åŠŸèƒ½: æå–å›¾åƒè¾¹ç¼˜è½®å»“
é€‚ç”¨åœºæ™¯:
  âœ“ ç²¾ç¡®å¤åˆ»æ„å›¾
  âœ“ å»ºç­‘ã€äº§å“è®¾è®¡
  âœ“ çº¿ç¨¿è½¬ç²¾ç»†å›¾
  âœ“ ä¿æŒç‰©ä½“è½®å»“

é¢„å¤„ç†å™¨: canny
æ¨¡å‹: control_v11p_sd15_canny

å‚æ•°é…ç½®:
  Canny Low Threshold: 50-100
  Canny High Threshold: 100-200
  // é˜ˆå€¼è¶Šä½ï¼Œæå–è¾¹ç¼˜è¶Šå¤š

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: å»ºç­‘ç…§ç‰‡
  æç¤ºè¯: cyberpunk city, neon lights, futuristic
  æ•ˆæœ: ä¿æŒå»ºç­‘ç»“æ„ï¼Œè½¬ä¸ºèµ›åšæœ‹å…‹é£æ ¼
```

**ä¼˜ç¼ºç‚¹ï¼š**

```mermaid
graph LR
    A[Canny] --> B[ä¼˜ç‚¹]
    A --> C[ç¼ºç‚¹]

    B --> D[ç²¾åº¦æé«˜<br/>è¾¹ç¼˜æ¸…æ™°]
    B --> E[é€‚ç”¨èŒƒå›´å¹¿<br/>é€šç”¨æ€§å¼º]

    C --> F[å¯èƒ½è¿‡äºä¸¥æ ¼<br/>åˆ›ä½œç©ºé—´å°]
    C --> G[å¤æ‚å›¾ç‰‡<br/>è¾¹ç¼˜è¿‡å¤š]

    style B fill:#5cb85c
    style C fill:#ff6b6b
```

---

### 2. Depthï¼ˆæ·±åº¦å›¾ï¼‰â­ æ¨è

```java
// åŠŸèƒ½: æå–å›¾åƒæ·±åº¦ä¿¡æ¯
é€‚ç”¨åœºæ™¯:
  âœ“ ä¿æŒç©ºé—´å…³ç³»
  âœ“ é£æ™¯ã€åœºæ™¯ç”Ÿæˆ
  âœ“ ä¿ç•™å‰åæ™¯å±‚æ¬¡
  âœ“ 3D æ„Ÿå¼ºçƒˆ

é¢„å¤„ç†å™¨: depth_midas / depth_leres++
æ¨¡å‹: control_v11f1p_sd15_depth

ç‰¹ç‚¹:
  - ä¸å…³æ³¨å…·ä½“ç‰©ä½“å½¢çŠ¶
  - å…³æ³¨è¿œè¿‘å±‚æ¬¡
  - é€‚åˆæ™¯æ·±æ§åˆ¶

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: é£æ™¯ç…§ç‰‡
  æç¤ºè¯: fantasy landscape, magical forest, glowing plants
  æ•ˆæœ: ä¿æŒå±±å·å±‚æ¬¡ï¼Œå˜ä¸ºå¥‡å¹»åœºæ™¯
```

**Depth é¢„å¤„ç†å™¨å¯¹æ¯”ï¼š**

| é¢„å¤„ç†å™¨ | é€Ÿåº¦ | è´¨é‡ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| **depth_midas** | âš¡âš¡âš¡âš¡ | â­â­â­ | æ—¥å¸¸ä½¿ç”¨ |
| **depth_leres** | âš¡âš¡ | â­â­â­â­ | é«˜è´¨é‡ |
| **depth_leres++** | âš¡ | â­â­â­â­â­ | æè‡´è´¨é‡ |
| **depth_zoe** | âš¡âš¡âš¡ | â­â­â­â­ | å¹³è¡¡é€‰æ‹© |

---

### 3. OpenPose / DWPoseï¼ˆäººä½“å§¿åŠ¿ï¼‰â­ äººç‰©å¿…å¤‡

```java
// åŠŸèƒ½: æ£€æµ‹äººä½“éª¨æ¶å’Œå§¿åŠ¿
é€‚ç”¨åœºæ™¯:
  âœ“ æ§åˆ¶è§’è‰²å§¿åŠ¿
  âœ“ åŠ¨ä½œå¤åˆ»
  âœ“ å¤šäººåœºæ™¯
  âœ“ æ‰‹åŠ¿æ§åˆ¶ï¼ˆDWPoseæ›´å¥½ï¼‰

é¢„å¤„ç†å™¨:
  - openpose_full: èº«ä½“+æ‰‹+è„¸
  - openpose_faceonly: ä»…é¢éƒ¨
  - dw_openpose_full: DWPoseç‰ˆæœ¬ï¼ˆæ¨èï¼‰

æ¨¡å‹: control_v11p_sd15_openpose

å‚æ•°:
  Body: âœ“  // èº«ä½“éª¨æ¶
  Hand: âœ“  // æ‰‹éƒ¨ç»†èŠ‚
  Face: âœ“  // é¢éƒ¨å…³é”®ç‚¹

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: èˆè¹ˆåŠ¨ä½œç…§ç‰‡
  æç¤ºè¯: anime girl, magical girl outfit, dynamic pose
  æ•ˆæœ: ä¿æŒèˆè¹ˆå§¿åŠ¿ï¼Œç»˜åˆ¶åŠ¨æ¼«é£æ ¼
```

**OpenPose vs DWPoseï¼š**

```java
// OpenPose (ä¼ ç»Ÿ)
ä¼˜ç‚¹: ç¨³å®šã€å…¼å®¹æ€§å¥½
ç¼ºç‚¹: æ‰‹éƒ¨æ£€æµ‹è¾ƒå¼±

// DWPose (æ–°ä¸€ä»£)
ä¼˜ç‚¹: æ‰‹éƒ¨ç²¾å‡†ã€æ•´ä½“æ£€æµ‹æ›´å¥½
ç¼ºç‚¹: éƒ¨åˆ†é¢„å¤„ç†å™¨å¯èƒ½è¾ƒæ…¢

æ¨è: DWPose (dw_openpose_full) âœ…
```

---

### 4. Lineartï¼ˆçº¿ç¨¿ï¼‰

```java
// åŠŸèƒ½: æå–å¹²å‡€çº¿ç¨¿
é€‚ç”¨åœºæ™¯:
  âœ“ é»‘ç™½çº¿ç¨¿ä¸Šè‰²
  âœ“ åŠ¨æ¼«é£æ ¼è½¬æ¢
  âœ“ è‰å›¾ç²¾åŒ–

é¢„å¤„ç†å™¨:
  - lineart_standard: æ ‡å‡†çº¿ç¨¿
  - lineart_coarse: ç²—ç³™çº¿ç¨¿ï¼ˆæ›´å®½å®¹ï¼‰
  - lineart_anime: åŠ¨æ¼«ä¸“ç”¨
  - lineart_realistic: å†™å®çº¿ç¨¿

æ¨¡å‹: control_v11p_sd15_lineart

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: é“…ç¬”è‰å›¾
  æç¤ºè¯: anime girl, colorful, detailed, vibrant colors
  æ•ˆæœ: ä¿ç•™çº¿ç¨¿ï¼Œæ·»åŠ è‰²å½©å’Œç»†èŠ‚
```

---

### 5. Scribbleï¼ˆæ¶‚é¸¦ï¼‰

```java
// åŠŸèƒ½: è¯†åˆ«ç®€å•æ¶‚é¸¦/è‰å›¾
é€‚ç”¨åœºæ™¯:
  âœ“ å¿«é€Ÿæ„å›¾
  âœ“ æ‰‹ç»˜è‰å›¾è½¬å›¾
  âœ“ ä½ä¿çœŸåŸå‹
  âœ“ åˆ›æ„é€Ÿå†™

é¢„å¤„ç†å™¨:
  - scribble_xdog: æå–è‰å›¾è¾¹ç¼˜
  - scribble_pidinet: æ›´ç²¾ç¡®çš„è¾¹ç¼˜
  - æˆ–ç›´æ¥æ‰‹ç»˜ï¼ˆé»‘åº•ç™½çº¿ / ç™½åº•é»‘çº¿ï¼‰

æ¨¡å‹: control_v11p_sd15_scribble

ç‰¹ç‚¹:
  - å®¹é”™ç‡é«˜
  - çº¿æ¡å¯ä»¥å¾ˆæ½¦è‰
  - é€‚åˆå¿«é€Ÿåˆ›ä½œ

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: iPad éšæ‰‹æ¶‚é¸¦
  æç¤ºè¯: beautiful landscape, mountains, lake, sunset
  æ•ˆæœ: å°†æ¶‚é¸¦å˜ä¸ºç²¾ç¾é£æ™¯ç”»
```

---

### 6. Tileï¼ˆç»†èŠ‚å¢å¼º/æ”¾å¤§ï¼‰â­ é«˜æ¸…å¿…å¤‡

```java
// åŠŸèƒ½: ä¿ç•™ç»†èŠ‚çš„é«˜æ¸…æ”¾å¤§
é€‚ç”¨åœºæ™¯:
  âœ“ å›¾ç‰‡æ— æŸæ”¾å¤§
  âœ“ ç»†èŠ‚å¢å¼º
  âœ“ ä¿®å¤æ¨¡ç³Šå›¾
  âœ“ é…åˆ Hires.fix

é¢„å¤„ç†å™¨: tile_resample / tile_colorfix
æ¨¡å‹: control_v11f1e_sd15_tile

ä¼˜åŠ¿:
  - æ¯”ä¼ ç»Ÿæ”¾å¤§ç®—æ³•æ›´æ™ºèƒ½
  - æ·»åŠ åˆç†ç»†èŠ‚è€Œéç®€å•æ’å€¼
  - ä¿æŒæ•´ä½“é£æ ¼ç»Ÿä¸€

é…ç½®å»ºè®®:
  ControlNet Weight: 0.6-0.8
  Denoising: 0.4-0.5
  é…åˆ Hires.fix æ•ˆæœæ›´ä½³

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: 512Ã—512 æ¨¡ç³Šå›¾
  æç¤ºè¯: ultra detailed, 8k, masterpiece
  æ•ˆæœ: æ”¾å¤§åˆ° 2048Ã—2048 æ¸…æ™°å›¾
```

---

### 7. Segï¼ˆè¯­ä¹‰åˆ†å‰²ï¼‰

```java
// åŠŸèƒ½: æŒ‰ç‰©ä½“ç±»åˆ«åˆ†å‰²å›¾åƒ
é€‚ç”¨åœºæ™¯:
  âœ“ ç²¾ç¡®æ§åˆ¶ä¸åŒåŒºåŸŸ
  âœ“ ä¿æŒç‰©ä½“ä½ç½®
  âœ“ æ¢èƒŒæ™¯/æ¢æœè£…
  âœ“ å¤æ‚åœºæ™¯é‡ç»˜

é¢„å¤„ç†å™¨:
  - seg_ofcoco: COCO æ•°æ®é›†åˆ†ç±»
  - seg_ofade20k: ADE20K æ•°æ®é›†
  - seg_ufade20k: é«˜ç²¾åº¦ç‰ˆæœ¬

æ¨¡å‹: control_v11p_sd15_seg

è‰²å—å«ä¹‰:
  - å¤©ç©º: è“è‰²
  - åœ°é¢: ç»¿è‰²/æ£•è‰²
  - å»ºç­‘: ç°è‰²
  - äººç‰©: çº¢è‰²
  (å…·ä½“é¢œè‰²æ ¹æ®æ•°æ®é›†)

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: äººç‰©+èƒŒæ™¯ç…§ç‰‡
  æç¤ºè¯: same person, fantasy background, magic castle
  æ•ˆæœ: ä¿æŒäººç‰©ä½ç½®ï¼Œæ›´æ¢èƒŒæ™¯ä¸ºé­”æ³•åŸå ¡
```

---

### 8. Referenceï¼ˆå‚è€ƒå›¾ï¼‰â­ é£æ ¼è¿ç§»

```java
// åŠŸèƒ½: åŸºäºå‚è€ƒå›¾ç”Ÿæˆç›¸ä¼¼é£æ ¼
é€‚ç”¨åœºæ™¯:
  âœ“ é£æ ¼è¿ç§»
  âœ“ ä¿æŒè§’è‰²ä¸€è‡´æ€§
  âœ“ ä»¿ç‰¹å®šç”»é£
  âœ“ IP è§’è‰²ç”Ÿæˆ

é¢„å¤„ç†å™¨: reference_only / reference_adain
æ¨¡å‹: (ä½¿ç”¨ SD è‡ªèº«çš„æ³¨æ„åŠ›æœºåˆ¶)

æ¨¡å¼:
  1. Style: ä»…è¿ç§»é£æ ¼
  2. Balanced: å¹³è¡¡é£æ ¼å’Œå†…å®¹
  3. Structure: æ›´å…³æ³¨ç»“æ„

Control Weight å»ºè®®: 0.5-0.8

å®æˆ˜æ¡ˆä¾‹:
  å‚è€ƒå›¾: æŸåŠ¨æ¼«è§’è‰²
  æç¤ºè¯: 1girl, different pose, outdoor
  æ•ˆæœ: ä¿æŒè§’è‰²ç‰¹å¾ï¼Œç”Ÿæˆæ–°å§¿åŠ¿
```

---

## ğŸ”§ æ ¸å¿ƒå‚æ•°è¯¦è§£

### 1. Control Weightï¼ˆæ§åˆ¶æƒé‡ï¼‰

```java
// æ§åˆ¶ ControlNet å½±å“å¼ºåº¦
èŒƒå›´: 0.0 - 2.0

æƒé‡æŒ‡å—:
  0.0 - 0.3: è½»å¾®å¼•å¯¼ï¼Œä»…å‚è€ƒ
  0.4 - 0.7: ä¸­ç­‰æ§åˆ¶ï¼ˆæ¨èèŒƒå›´ï¼‰ âœ…
  0.8 - 1.0: å¼ºæ§åˆ¶ï¼Œä¸¥æ ¼éµå¾ª
  1.1 - 1.5: éå¸¸ä¸¥æ ¼
  1.6+: è¿‡åº¦æ§åˆ¶ï¼Œå¯èƒ½åƒµç¡¬

é»˜è®¤å€¼: 1.0

è°ƒè¯•ç­–ç•¥:
  ç»“æ„åç¦» â†’ æé«˜æƒé‡ (1.0 â†’ 1.2)
  ç”»é¢åƒµç¡¬ â†’ é™ä½æƒé‡ (1.0 â†’ 0.7)
  éœ€è¦åˆ›ä½œç©ºé—´ â†’ ä½¿ç”¨ 0.5-0.7
```

---

### 2. Starting/Ending Control Step

```java
// æ§åˆ¶ ControlNet åœ¨å“ªäº›é‡‡æ ·æ­¥éª¤ç”Ÿæ•ˆ
èŒƒå›´: 0.0 - 1.0 (ç™¾åˆ†æ¯”)

å…¸å‹é…ç½®:
  Starting: 0.0  // ä»ç¬¬ä¸€æ­¥å¼€å§‹
  Ending: 1.0    // ç›´åˆ°æœ€åä¸€æ­¥

è¿›é˜¶ç”¨æ³•:
  // æ—©æœŸæ§åˆ¶æ„å›¾ï¼ŒåæœŸè‡ªç”±å‘æŒ¥
  Starting: 0.0
  Ending: 0.6    // ä»…åœ¨å‰ 60% æ­¥éª¤æ§åˆ¶

  // å»¶è¿Ÿæ§åˆ¶ï¼Œå…ˆè‡ªç”±ç”Ÿæˆåçº¦æŸ
  Starting: 0.3  // ä» 30% æ­¥éª¤å¼€å§‹
  Ending: 1.0

å®æˆ˜ç¤ºä¾‹:
  Steps = 28, Ending = 0.6
  â†’ å‰ 17 steps å—æ§ï¼Œå 11 steps è‡ªç”±
  â†’ ä¿ç•™å¤§è‡´ç»“æ„ï¼Œç»†èŠ‚æ›´è‡ªç„¶
```

---

### 3. Control Modeï¼ˆæ§åˆ¶æ¨¡å¼ï¼‰

```java
// æ§åˆ¶ä¼˜å…ˆçº§
é€‰é¡¹:
  1. Balanced: å¹³è¡¡æç¤ºè¯å’Œ ControlNet
  2. My prompt is more important: æç¤ºè¯ä¼˜å…ˆ
  3. ControlNet is more important: æ§åˆ¶å›¾ä¼˜å…ˆ

ä½¿ç”¨å»ºè®®:
  æ—¥å¸¸åˆ›ä½œ: Balancedï¼ˆé»˜è®¤ï¼‰
  ä¸¥æ ¼å¤åˆ»å§¿åŠ¿: ControlNet ä¼˜å…ˆ
  åˆ›æ„å˜ä½“: Prompt ä¼˜å…ˆ

ç¤ºä¾‹åœºæ™¯:
  æç¤ºè¯: beautiful sunset
  ControlNet: é˜´å¤©ç…§ç‰‡æ·±åº¦å›¾

  Balanced: ä¿æŒæ„å›¾ï¼Œæ·»åŠ å¤•é˜³å…ƒç´ 
  Prompt ä¼˜å…ˆ: å¯èƒ½æ”¹å˜æ„å›¾ä»¥åŒ¹é…å¤•é˜³
  ControlNet ä¼˜å…ˆ: ä¸¥æ ¼ä¿æŒæ„å›¾ï¼Œè½»å¾®æ·»åŠ æš–è‰²
```

---

### 4. Resize Modeï¼ˆç¼©æ”¾æ¨¡å¼ï¼‰

```java
// å‚è€ƒå›¾ä¸ç”Ÿæˆå›¾å°ºå¯¸ä¸ä¸€è‡´æ—¶çš„å¤„ç†
é€‰é¡¹:
  1. Just Resize: ç›´æ¥ç¼©æ”¾
     - å¯èƒ½å˜å½¢
     - é€Ÿåº¦æœ€å¿«

  2. Crop and Resize: è£å‰ªåç¼©æ”¾
     - ä¿æŒæ¯”ä¾‹
     - å¯èƒ½ä¸¢å¤±éƒ¨åˆ†å†…å®¹

  3. Resize and Fill: ç¼©æ”¾åå¡«å……
     - ä¿æŒå®Œæ•´å†…å®¹
     - å¯èƒ½æœ‰è¾¹ç¼˜å¡«å……

æ¨è: Crop and Resizeï¼ˆä¿æŒæ¯”ä¾‹ï¼‰
```

---

## ğŸ¨ å®æˆ˜åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå§¿åŠ¿æ§åˆ¶ï¼ˆOpenPoseï¼‰

```java
// ç›®æ ‡: è®©åŠ¨æ¼«è§’è‰²åšçœŸäººç…§ç‰‡çš„åŠ¨ä½œ
å‚è€ƒå›¾: èˆè¹ˆåŠ¨ä½œç…§ç‰‡ (çœŸäºº)

é…ç½®:
  Preprocessor: dw_openpose_full
  Model: control_v11p_sd15_openpose
  Control Weight: 1.0
  Control Mode: Balanced

æç¤ºè¯:
  anime girl, magical girl, colorful outfit,
  dynamic pose, detailed, high quality,
  <lora:anime_style:0.8>

Negative:
  realistic, 3d, photo

ç”Ÿæˆå‚æ•°:
  Steps: 28
  CFG: 8
  Sampler: DPM++ 2M Karras

æ•ˆæœ:
  å®Œå…¨å¤åˆ»èˆè¹ˆåŠ¨ä½œï¼ŒåŠ¨æ¼«é£æ ¼å‘ˆç°
```

---

### åœºæ™¯2ï¼šæ„å›¾å¤åˆ»ï¼ˆCanny + Depthï¼‰

```java
// ç›®æ ‡: å°†é£æ™¯ç…§è½¬ä¸ºå¥‡å¹»åœºæ™¯
å‚è€ƒå›¾: å±±å·æ¹–æ³Šç…§ç‰‡

ControlNet 1 - Depth:
  Preprocessor: depth_leres++
  Weight: 0.8
  ä½œç”¨: ä¿æŒè¿œè¿‘æ™¯å±‚æ¬¡

ControlNet 2 - Canny:
  Preprocessor: canny
  Weight: 0.6
  ä½œç”¨: ä¿æŒå±±å³°è½®å»“

æç¤ºè¯:
  fantasy landscape, magical forest, glowing trees,
  floating islands, aurora sky, dreamy atmosphere

æ•ˆæœ:
  ç²¾ç¡®ä¿æŒæ„å›¾ï¼Œè½¬ä¸ºå¥‡å¹»é£æ ¼

æ³¨æ„: å¤š ControlNet å åŠ æ—¶æ€»æƒé‡ä¸è¦è¶…è¿‡ 2.0
```

---

### åœºæ™¯3ï¼šçº¿ç¨¿ä¸Šè‰²ï¼ˆLineartï¼‰

```java
// ç›®æ ‡: é»‘ç™½çº¿ç¨¿è½¬å½©è‰²æ’ç”»
å‚è€ƒå›¾: å¹²å‡€çš„åŠ¨æ¼«çº¿ç¨¿

é…ç½®:
  Preprocessor: lineart_anime
  Model: control_v11p_sd15_lineart
  Control Weight: 1.2  // ä¸¥æ ¼ä¿ç•™çº¿æ¡
  Control Mode: ControlNet is more important

æç¤ºè¯:
  1girl, colorful hair, detailed eyes, vibrant colors,
  anime style, cel shading, official art

ç”Ÿæˆå‚æ•°:
  CFG: 9  // æé«˜ä»¥å¼ºåŒ–æç¤ºè¯
  Denoising: 0.7 (å¦‚æœæ˜¯ img2img)

æŠ€å·§:
  - Weight è®¾é«˜ (1.0-1.3) ä¿è¯çº¿ç¨¿å®Œæ•´
  - ä½¿ç”¨ Lineart ä¸“ç”¨é¢„å¤„ç†å™¨
  - æç¤ºè¯è¯¦ç»†æè¿°é¢œè‰²
```

---

### åœºæ™¯4ï¼šè‰å›¾è½¬ç²¾å›¾ï¼ˆScribbleï¼‰

```java
// ç›®æ ‡: iPad å¿«é€Ÿæ¶‚é¸¦ â†’ å®Œæ•´ä½œå“
å‚è€ƒå›¾: éšæ‰‹ç”»çš„ç®€ç¬”ç”»ï¼ˆé»‘ç™½ï¼‰

é…ç½®:
  Preprocessor: None  // ç›´æ¥ä½¿ç”¨æ‰‹ç»˜å›¾
  Model: control_v11p_sd15_scribble
  Control Weight: 0.7  // ä¸è¦å¤ªä¸¥æ ¼
  Control Mode: Balanced

è¾“å…¥å›¾è¦æ±‚:
  - ç™½åº•é»‘çº¿ æˆ– é»‘åº•ç™½çº¿
  - çº¿æ¡å¯ä»¥å¾ˆæ½¦è‰
  - æ ‡æ³¨å¤§è‡´ä½ç½®å³å¯

æç¤ºè¯:
  detailed illustration, professional artwork,
  vibrant colors, high quality

æ•ˆæœ:
  å°†æ¶‚é¸¦è½¬ä¸ºç²¾ç¾æ’ç”»
  ä¿ç•™å¤§è‡´æ„å›¾ä½†ç»†èŠ‚å…¨æ–°
```

---

### åœºæ™¯5ï¼šæ— æŸæ”¾å¤§ï¼ˆTileï¼‰

```java
// ç›®æ ‡: 512Ã—512 æ”¾å¤§åˆ° 2048Ã—2048
åŸå›¾: å°å°ºå¯¸ä½†è´¨é‡ä¸é”™çš„å›¾

é˜¶æ®µ1 - Hires.fix:
  Upscaler: R-ESRGAN 4x+
  Upscale by: 2.0 (512 â†’ 1024)
  Hires Steps: 18
  Denoising: 0.45

é˜¶æ®µ2 - ControlNet Tile:
  ControlNet:
    Preprocessor: tile_resample
    Model: control_v11f1e_sd15_tile
    Control Weight: 0.7
    Starting: 0.0
    Ending: 1.0

  Upscale by: 2.0 (1024 â†’ 2048)
  Denoising: 0.4

æ•ˆæœ:
  é€æ­¥æ”¾å¤§ï¼Œä¿æŒç»†èŠ‚æ¸…æ™°
  æ¯”ä¸€æ¬¡æ€§æ”¾å¤§ 4 å€è´¨é‡æ›´å¥½
```

---

### åœºæ™¯6ï¼šè§’è‰²ä¸€è‡´æ€§ï¼ˆReferenceï¼‰

```java
// ç›®æ ‡: ç”ŸæˆåŒä¸€è§’è‰²çš„ä¸åŒå§¿åŠ¿
å‚è€ƒå›¾: è§’è‰²è®¾å®šå›¾

é…ç½®:
  ControlNet: reference_only
  Control Weight: 0.6
  Style Fidelity: 0.5
  Reference Mode: Style

æç¤ºè¯:
  1girl, different pose, outdoor background,
  [æè¿°è§’è‰²ç‰¹å¾]

é¢å¤–æŠ€å·§:
  - å¦‚éœ€æ›´å¼ºä¸€è‡´æ€§ï¼Œä½¿ç”¨ Ref + OpenPose åŒé‡æ§åˆ¶
  - Reference æä¾›è§’è‰²ç‰¹å¾
  - OpenPose æä¾›æ–°å§¿åŠ¿
```

---

## ğŸš€ è¿›é˜¶æŠ€å·§

### 1. å¤š ControlNet å åŠ 

```java
// æœ€å¤šå¯åŒæ—¶ä½¿ç”¨ 3-4 ä¸ª ControlNet
æ¨èç»„åˆ:

ç»„åˆ1: Pose + Depth
  OpenPose: æ§åˆ¶å§¿åŠ¿ (Weight 1.0)
  Depth: æ§åˆ¶ç©ºé—´ (Weight 0.6)
  é€‚åˆ: äººç‰©+åœºæ™¯ç²¾å‡†æ§åˆ¶

ç»„åˆ2: Canny + Reference
  Canny: æ§åˆ¶è½®å»“ (Weight 0.7)
  Reference: ç»Ÿä¸€é£æ ¼ (Weight 0.5)
  é€‚åˆ: é£æ ¼è¿ç§» + æ„å›¾ä¿ç•™

ç»„åˆ3: Tile + Depth + Canny
  Tile: ç»†èŠ‚å¢å¼º (Weight 0.6)
  Depth: ç©ºé—´å±‚æ¬¡ (Weight 0.5)
  Canny: è¾¹ç¼˜å¼•å¯¼ (Weight 0.4)
  é€‚åˆ: é«˜æ¸…æ”¾å¤§ + ç»“æ„ä¼˜åŒ–

æ³¨æ„äº‹é¡¹:
  âš ï¸ æ€»æƒé‡å»ºè®® < 2.5
  âš ï¸ è¿‡å¤šControlNetä¼šå†²çª
  âš ï¸ æŒ‰ä¸»æ¬¡åˆ†é…æƒé‡
```

---

### 2. é¢„å¤„ç†å™¨å‚æ•°è°ƒä¼˜

```java
// Canny é˜ˆå€¼è°ƒæ•´
Low Threshold: 50 (é™ä½æ£€æµ‹æ›´å¤šè¾¹ç¼˜)
High Threshold: 200 (æé«˜å‡å°‘è¾¹ç¼˜)

è°ƒè¯•:
  - è¾¹ç¼˜å¤ªå°‘ â†’ é™ä½é˜ˆå€¼
  - è¾¹ç¼˜å¤ªå¤š â†’ æé«˜é˜ˆå€¼
  - é¢„è§ˆé¢„å¤„ç†ç»“æœåè°ƒæ•´

// Depth é¢„å¤„ç†å™¨é€‰æ‹©
å¿«é€Ÿæµ‹è¯•: depth_midas
æœ€ç»ˆå‡ºå›¾: depth_leres++
å¹³è¡¡é€‰æ‹©: depth_zoe
```

---

### 3. Ending Step åˆ›æ„ç”¨æ³•

```java
// æŠ€å·§: æ—©æœŸæ§åˆ¶ï¼ŒåæœŸè‡ªç”±
é…ç½®:
  Control Weight: 1.0
  Starting: 0.0
  Ending: 0.5  // ä»…å‰ä¸€åŠæ­¥éª¤

æ•ˆæœ:
  - å‰åŠæ®µ: ä¸¥æ ¼éµå¾ªæ§åˆ¶å›¾
  - ååŠæ®µ: è‡ªç”±ä¼˜åŒ–ç»†èŠ‚
  - ç»“æœ: ä¿æŒç»“æ„ä½†æ›´è‡ªç„¶

é€‚ç”¨:
  - é¿å…ç”»é¢è¿‡äºåƒµç¡¬
  - ä¿ç•™åˆ›ä½œç©ºé—´
  - ç»†èŠ‚æ›´ç”ŸåŠ¨
```

---

### 4. ControlNet + LoRA ç»„åˆ

```java
// é»„é‡‘ç»„åˆ: ç»“æ„æ§åˆ¶ + é£æ ¼è¿ç§»
ControlNet: OpenPose (æ§åˆ¶å§¿åŠ¿)
LoRA: <lora:ghibli_style:0.8> (å‰åœåŠ›é£æ ¼)

æç¤ºè¯:
  anime girl, ghibli style, soft lighting,
  <lora:ghibli_style:0.8>

ControlNet é…ç½®:
  Weight: 1.0 (å§¿åŠ¿ä¸¥æ ¼)
  Ending: 0.7 (åæœŸæ”¾æ¾æ§åˆ¶)

æ•ˆæœ:
  å§¿åŠ¿ç²¾å‡† + é£æ ¼ç»Ÿä¸€
```

---

### 5. IP-Adapter é…åˆ

```java
// IP-Adapter: å¦ä¸€ç§å‚è€ƒå›¾æ–¹æ³•
åŒºåˆ«:
  Reference ControlNet:
    - åŸºäºæ³¨æ„åŠ›æœºåˆ¶
    - åå‘æ•´ä½“é£æ ¼

  IP-Adapter:
    - åŸºäº CLIP å›¾åƒç¼–ç 
    - æ›´å¼ºçš„è¯­ä¹‰ç†è§£

ç»„åˆä½¿ç”¨:
  IP-Adapter: æä¾›è§’è‰²ç‰¹å¾ (Weight 0.6)
  OpenPose: æ§åˆ¶å§¿åŠ¿ (Weight 1.0)

æ•ˆæœ: æœ€å¼ºè§’è‰²ä¸€è‡´æ€§æ§åˆ¶
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜è¯Šæ–­è¡¨

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| **å®Œå…¨ä¸èµ·ä½œç”¨** | æ¨¡å‹æœªä¸‹è½½/è·¯å¾„é”™è¯¯ | æ£€æŸ¥ models/ControlNet/ ç›®å½• |
| **æ•ˆæœå¾ˆå¼±** | Weight å¤ªä½ | æé«˜åˆ° 0.8-1.0 |
| **ç”»é¢åƒµç¡¬** | Weight å¤ªé«˜ | é™ä½åˆ° 0.6-0.7 æˆ–è°ƒæ•´ Ending |
| **å§¿åŠ¿é”™è¯¯** | é¢„å¤„ç†å™¨æ£€æµ‹å¤±è´¥ | æ›´æ¢é¢„å¤„ç†å™¨æˆ–æ‰‹åŠ¨ä¿®æ­£æ§åˆ¶å›¾ |
| **æ‰‹éƒ¨å´©å** | OpenPose æ£€æµ‹ä¸å‡† | ä½¿ç”¨ DWPose æˆ–æ‰‹åŠ¨ç¼–è¾‘éª¨æ¶ |
| **å¤šControlNetå†²çª** | æƒé‡åˆ†é…ä¸åˆç† | é™ä½æ¬¡è¦ControlNetæƒé‡ |
| **æ˜¾å­˜ä¸è¶³** | å¤šControlNet+é«˜åˆ†è¾¨ç‡ | å‡å°‘ControlNetæ•°é‡æˆ–é™ä½åˆ†è¾¨ç‡ |

---

### è°ƒè¯•æµç¨‹

```mermaid
graph TD
    A[å¯ç”¨ ControlNet] --> B{é¢„è§ˆé¢„å¤„ç†ç»“æœ}
    B -->|ä¸å‡†ç¡®| C[è°ƒæ•´é¢„å¤„ç†å™¨å‚æ•°<br/>æˆ–æ›´æ¢é¢„å¤„ç†å™¨]
    B -->|å‡†ç¡®| D[è®¾ç½® Weight: 1.0]

    C --> B
    D --> E{ç”Ÿæˆæµ‹è¯•}

    E -->|æ•ˆæœå¼±| F[æé«˜ Weight<br/>1.0 â†’ 1.2]
    E -->|ç”»é¢åƒµç¡¬| G[é™ä½ Weight<br/>1.0 â†’ 0.7<br/>æˆ– Ending: 0.6]
    E -->|æ»¡æ„| H[ä¿å­˜é…ç½®]

    F --> E
    G --> E

    style H fill:#5cb85c
```

---

## ğŸ“š èµ„æºä¸å·¥å…·

### ControlNet æ¨¡å‹ä¸‹è½½

```java
// å®˜æ–¹æ¨¡å‹
æ¥æº: Hugging Face (lllyasviel/ControlNet)
ç‰ˆæœ¬: v1.1 (æ¨è)
æ ¼å¼: .pth / .safetensors

å¸¸ç”¨æ¨¡å‹åˆ—è¡¨:
  - control_v11p_sd15_canny
  - control_v11f1p_sd15_depth
  - control_v11p_sd15_openpose
  - control_v11p_sd15_lineart
  - control_v11p_sd15_scribble
  - control_v11f1e_sd15_tile
  - control_v11p_sd15_seg

ä¸‹è½½åæ”¾ç½®:
  stable-diffusion-webui/models/ControlNet/
```

---

### è¾…åŠ©å·¥å…·

```java
// 1. OpenPose Editor (WebUI æ’ä»¶)
åŠŸèƒ½: æ‰‹åŠ¨ç¼–è¾‘éª¨æ¶
ç”¨é€”: ä¿®æ­£æ£€æµ‹é”™è¯¯ï¼Œåˆ›å»ºè‡ªå®šä¹‰å§¿åŠ¿

// 2. ControlNet Annotator
åŠŸèƒ½: ç‹¬ç«‹é¢„å¤„ç†å·¥å…·
ç”¨é€”: æ‰¹é‡ç”Ÿæˆæ§åˆ¶å›¾

// 3. Blender + OpenPose
åŠŸèƒ½: 3D æ¨¡å‹å¯¼å‡ºå§¿åŠ¿
ç”¨é€”: åˆ›å»ºå¤æ‚åŠ¨ä½œå‚è€ƒ
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### æ–°æ‰‹æ¨èæµç¨‹

```java
// ç¬¬1æ­¥: é€‰æ‹©åˆé€‚çš„ ControlNet ç±»å‹
äººç‰©å§¿åŠ¿ â†’ OpenPose / DWPose
å»ºç­‘/äº§å“ â†’ Canny
é£æ™¯ â†’ Depth
çº¿ç¨¿ â†’ Lineart
è‰å›¾ â†’ Scribble

// ç¬¬2æ­¥: æ ‡å‡†é…ç½®
Control Weight: 1.0 (èµ·ç‚¹)
Control Mode: Balanced
Starting: 0.0
Ending: 1.0

// ç¬¬3æ­¥: é¢„è§ˆé¢„å¤„ç†
ç‚¹å‡» "Preview" æŸ¥çœ‹æ§åˆ¶å›¾
ç¡®è®¤æå–çš„ä¿¡æ¯æ­£ç¡®

// ç¬¬4æ­¥: ä½åˆ†è¾¨ç‡æµ‹è¯•
å…ˆç”¨ 512Ã—512 å¿«é€Ÿæµ‹è¯•
ç¡®è®¤æ•ˆæœåå†é«˜åˆ†è¾¨ç‡ç”Ÿæˆ

// ç¬¬5æ­¥: å¾®è°ƒ
æ ¹æ®æ•ˆæœè°ƒæ•´ Weight å’Œ Ending
```

---

### æ€§èƒ½ä¼˜åŒ–

```java
// æ˜¾å­˜ä¼˜åŒ–
1. å•æ¬¡åªç”¨ 1-2 ä¸ª ControlNet
2. é™ä½é¢„å¤„ç†åˆ†è¾¨ç‡ï¼ˆPreprocessor Resolution: 512ï¼‰
3. ä½¿ç”¨ --lowvram æˆ– --medvram å¯åŠ¨å‚æ•°

// é€Ÿåº¦ä¼˜åŒ–
1. é€‰æ‹©å¿«é€Ÿé¢„å¤„ç†å™¨
   - depth_midas (å¿«) vs depth_leres++ (æ…¢)
2. é™ä½åˆ†è¾¨ç‡æµ‹è¯•
3. å‡å°‘é‡‡æ ·æ­¥æ•° (20-25 steps)
```

---

## ğŸ”— ç›¸å…³æ–‡ç« 

- [Denoising Strength è¯¦è§£](./10-DenoisingStrengthè¯¦è§£-é‡ç»˜å¹…åº¦æ§åˆ¶.md) - å›¾ç”Ÿå›¾æ ¸å¿ƒå‚æ•°
- [LoRA è¯¦è§£](./08-LoRAè¯¦è§£-é£æ ¼è¿ç§»çš„åˆ©å™¨.md) - ControlNet + LoRA ç»„åˆ
- [Hires.fix è¯¦è§£](./09-HiresFixè¯¦è§£-é«˜æ¸…æ”¾å¤§çš„è‰ºæœ¯.md) - Tile ControlNet åº”ç”¨

---

## ğŸ“ æ€»ç»“

**ControlNet æ ¸å¿ƒä»·å€¼ï¼š**

1. **ç²¾å‡†æ§åˆ¶**: å‘Šåˆ«éšæœºï¼Œæƒ³ç”»å•¥å°±ç”»å•¥
2. **å¤šæ ·ç»„åˆ**: å§¿åŠ¿+é£æ ¼+ç»†èŠ‚å…¨æ–¹ä½æ§åˆ¶
3. **åˆ›ä½œææ•ˆ**: å‚è€ƒå›¾ç›´æ¥è½¬åˆ›æ„ï¼Œçœæ—¶çœåŠ›

**ä½¿ç”¨å£è¯€ï¼š**
```
é€‰å¯¹ç±»å‹æ˜¯åŸºç¡€
æƒé‡é€‚ä¸­æœ€é‡è¦
é¢„è§ˆæ§åˆ¶å›¾å¿…åš
å•ä¸ªæµ‹è¯•å†å åŠ 
```

---

**ControlNet æ˜¯ SD ä»"éšæœºè‰ºæœ¯"åˆ°"ç²¾å‡†åˆ›ä½œ"çš„é©å‘½ï¼** ğŸš€

æŒæ¡ ControlNetï¼Œä½ å°±èƒ½ç²¾ç¡®æ§åˆ¶ AI çš„æ¯ä¸€ç¬”ï¼ŒçœŸæ­£å®ç°"æ‰€æƒ³å³æ‰€å¾—"ï¼

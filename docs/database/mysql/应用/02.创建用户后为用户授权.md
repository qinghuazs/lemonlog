# 创建用户后为用户授权

## 1. 基本授权语法

```sql
GRANT 权限列表 ON 数据库.表名 TO '用户名'@'主机';
```

## 2. 常用权限类型

### 2.1 数据操作权限
- `SELECT` - 查询数据
- `INSERT` - 插入数据
- `UPDATE` - 更新数据
- `DELETE` - 删除数据

### 2.2 结构操作权限
- `CREATE` - 创建数据库或表
- `DROP` - 删除数据库或表
- `ALTER` - 修改表结构
- `INDEX` - 创建/删除索引

### 2.3 管理权限
- `ALL PRIVILEGES` - 所有权限
- `GRANT OPTION` - 授权给其他用户的权限

## 3. 授权范围

### 3.1 全局授权
```sql
-- 授予所有数据库的所有权限
GRANT ALL PRIVILEGES ON *.* TO 'username'@'localhost';
```

### 3.2 数据库级授权
```sql
-- 授予特定数据库的所有权限
GRANT ALL PRIVILEGES ON database_name.* TO 'username'@'localhost';

-- 授予特定数据库的查询权限
GRANT SELECT ON database_name.* TO 'username'@'localhost';
```

### 3.3 表级授权
```sql
-- 授予特定表的权限
GRANT SELECT, INSERT, UPDATE ON database_name.table_name TO 'username'@'localhost';
```

### 3.4 列级授权
```sql
-- 授予特定列的权限
GRANT SELECT (column1, column2) ON database_name.table_name TO 'username'@'localhost';
```

## 4. 实际应用示例

### 4.1 创建只读用户
```sql
-- 创建用户
CREATE USER 'readonly_user'@'%' IDENTIFIED BY 'password123';

-- 授予只读权限
GRANT SELECT ON myapp.* TO 'readonly_user'@'%';

-- 刷新权限
FLUSH PRIVILEGES;
```

### 4.2 创建应用用户
```sql
-- 创建用户
CREATE USER 'app_user'@'192.168.1.%' IDENTIFIED BY 'app_password';

-- 授予数据操作权限
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'app_user'@'192.168.1.%';

-- 刷新权限
FLUSH PRIVILEGES;
```

### 4.3 创建管理用户
```sql
-- 创建用户
CREATE USER 'admin_user'@'localhost' IDENTIFIED BY 'admin_password';

-- 授予管理权限
GRANT ALL PRIVILEGES ON myapp.* TO 'admin_user'@'localhost';

-- 授予权限管理能力
GRANT GRANT OPTION ON myapp.* TO 'admin_user'@'localhost';

-- 刷新权限
FLUSH PRIVILEGES;
```

## 5. 权限管理命令

### 5.1 查看用户权限
```sql
-- 查看当前用户权限
SHOW GRANTS;

-- 查看指定用户权限
SHOW GRANTS FOR 'username'@'hostname';
```

### 5.2 撤销权限
```sql
-- 撤销特定权限
REVOKE SELECT ON database_name.* FROM 'username'@'hostname';

-- 撤销所有权限
REVOKE ALL PRIVILEGES ON database_name.* FROM 'username'@'hostname';
```

### 5.3 刷新权限
```sql
-- 使权限立即生效
FLUSH PRIVILEGES;
```

## 6. 最佳实践

### 6.1 权限最小化原则
- 只授予必要的权限
- 避免使用 `ALL PRIVILEGES`
- 定期审查用户权限

### 6.2 安全建议
```sql
-- 1. 创建专用应用用户，避免使用 root
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'strong_password';

-- 2. 限制主机访问范围
CREATE USER 'user'@'192.168.1.%' IDENTIFIED BY 'password';

-- 3. 设置密码复杂度要求
ALTER USER 'username'@'hostname' PASSWORD EXPIRE INTERVAL 90 DAY;
```

### 6.3 权限分级管理
```sql
-- 开发环境用户
GRANT SELECT, INSERT, UPDATE, DELETE ON dev_db.* TO 'dev_user'@'%';

-- 测试环境用户
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON test_db.* TO 'test_user'@'%';

-- 生产环境用户（更严格的权限控制）
GRANT SELECT, INSERT, UPDATE, DELETE ON prod_db.user_table TO 'prod_user'@'10.0.0.%';
```

## 7. 常见错误和解决方案

### 7.1 权限不生效
```sql
-- 解决方案：刷新权限
FLUSH PRIVILEGES;
```

### 7.2 用户无法连接
```sql
-- 检查用户是否存在
SELECT User, Host FROM mysql.user WHERE User='username';

-- 检查用户权限
SHOW GRANTS FOR 'username'@'hostname';
```

### 7.3 权限不足错误
```sql
-- 检查具体权限
SHOW GRANTS FOR 'username'@'hostname';

-- 添加缺失的权限
GRANT MISSING_PRIVILEGE ON database.table TO 'username'@'hostname';
```
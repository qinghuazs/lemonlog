---
title: Claude Codeæ¶æ„è¯¦è§£ï¼ˆäºŒåï¼‰ï¼šæ„å»ºè‡ªå·±çš„AIç¼–ç¨‹åŠ©æ‰‹
date: 2025-01-14
permalink: /ai/claude-code/architecture/20-build-your-own-ai-assistant.html
tags:
  - Claude Code
  - AIç¼–ç¨‹åŠ©æ‰‹
  - æ¶æ„å®æˆ˜
  - å…¨æ ˆå¼€å‘
categories:
  - AI
  - Claude Code
---

# ç¬¬20ç¯‡ï¼šæ„å»ºè‡ªå·±çš„AIç¼–ç¨‹åŠ©æ‰‹

## 1. å¼•è¨€

### 1.1 ç³»åˆ—å›é¡¾

æ¬¢è¿æ¥åˆ°ã€ŠClaude Codeæ¶æ„è¯¦è§£ã€‹ç³»åˆ—çš„æœ€åä¸€ç¯‡ï¼åœ¨è¿‡å»çš„19ç¯‡æ–‡ç« ä¸­,æˆ‘ä»¬ä»æ¶æ„è®¾è®¡åˆ°å…·ä½“å®ç°,å…¨é¢å‰–æäº†Claude Codeçš„æŠ€æœ¯å†…å¹•:

**æ¶æ„ç¯‡ï¼ˆ1-5ï¼‰**:
- ç¬¬1ç¯‡ï¼šæ•´ä½“æ¶æ„è®¾è®¡ - åˆ†å±‚æ¶æ„ã€æŠ€æœ¯æ ˆé€‰å‹
- ç¬¬2ç¯‡ï¼šæ ¸å¿ƒå¼•æ“å®ç° - AIå¼•æ“ã€Promptå·¥ç¨‹
- ç¬¬3ç¯‡ï¼šä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿ - Tokenç®¡ç†ã€æ™ºèƒ½æˆªæ–­
- ç¬¬4ç¯‡ï¼šä¼šè¯ä¸çŠ¶æ€ç®¡ç† - æŒä¹…åŒ–ã€ä¼šè¯æ¢å¤
- ç¬¬5ç¯‡ï¼šå·¥å…·ç³»ç»Ÿæ¶æ„ - Tool Callingã€å·¥å…·æ³¨å†Œ

**å·¥å…·å®ç°ç¯‡ï¼ˆ6-8ï¼‰**:
- ç¬¬6ç¯‡ï¼šæ–‡ä»¶æ“ä½œå·¥å…· - Readã€Writeã€Edit
- ç¬¬7ç¯‡ï¼šä»£ç æœç´¢ä¸åˆ†æ - Globã€Grep
- ç¬¬8ç¯‡ï¼šç»ˆç«¯é›†æˆå®ç° - Bashã€å‘½ä»¤æ‰§è¡Œ

**åè®®ä¸é›†æˆç¯‡ï¼ˆ9-12ï¼‰**:
- ç¬¬9ç¯‡ï¼šMCPåè®®æ·±å…¥è§£æ - åè®®è§„èŒƒã€é€šä¿¡æœºåˆ¶
- ç¬¬10ç¯‡ï¼šæµè§ˆå™¨è‡ªåŠ¨åŒ–é›†æˆ - Playwrighté›†æˆ
- ç¬¬11ç¯‡ï¼šAgentå·¥ä½œæµå¼•æ“ - ä»»åŠ¡åˆ†è§£ã€æ‰§è¡Œå¼•æ“
- ç¬¬12ç¯‡ï¼šå¤šæ¨¡æ€äº¤äº’å®ç° - å›¾åƒã€PDFå¤„ç†

**ä¼˜åŒ–ä¸å·¥ç¨‹ç¯‡ï¼ˆ13-16ï¼‰**:
- ç¬¬13ç¯‡ï¼šæ€§èƒ½ä¼˜åŒ–æ·±åº¦å‰–æ - ç¼“å­˜ã€å¹¶å‘ã€å†…å­˜
- ç¬¬14ç¯‡ï¼šé”™è¯¯å¤„ç†ä¸æ¢å¤ - é‡è¯•ã€é™çº§ã€å®¹é”™
- ç¬¬15ç¯‡ï¼šå®‰å…¨æœºåˆ¶è®¾è®¡ - æƒé™æ§åˆ¶ã€æ²™ç®±
- ç¬¬16ç¯‡ï¼šæµ‹è¯•ä¸è´¨é‡ä¿è¯ - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•

**å®æˆ˜ç¯‡ï¼ˆ17-19ï¼‰**:
- ç¬¬17ç¯‡ï¼šè‡ªå®šä¹‰å·¥å…·å¼€å‘å®æˆ˜ - 3ä¸ªå®Œæ•´æ¡ˆä¾‹
- ç¬¬18ç¯‡ï¼šMCP Serverå¼€å‘å®æˆ˜ - Serveræ¶æ„
- ç¬¬19ç¯‡ï¼šä¼ä¸šçº§åº”ç”¨å®è·µ - éƒ¨ç½²ã€ç›‘æ§

### 1.2 ä¸ºä»€ä¹ˆè¦æ„å»ºè‡ªå·±çš„AIç¼–ç¨‹åŠ©æ‰‹ï¼Ÿ

**å•†ä¸šä»·å€¼**:
- ğŸ’° å®šåˆ¶åŒ–æœåŠ¡ï¼šæ ¹æ®ç‰¹å®šè¡Œä¸šå’Œåœºæ™¯ä¼˜åŒ–
- ğŸ’° æ•°æ®å®‰å…¨ï¼šæ•æ„Ÿä»£ç ä¸å‡ºä¼ä¸šå†…ç½‘
- ğŸ’° æˆæœ¬æ§åˆ¶ï¼šè‡ªä¸»é€‰æ‹©AIæ¨¡å‹å’Œè®¡è´¹æ–¹å¼
- ğŸ’° ç«äº‰ä¼˜åŠ¿ï¼šæ‰“é€ å·®å¼‚åŒ–äº§å“

**æŠ€æœ¯ä»·å€¼**:
- ğŸš€ æ·±å…¥ç†è§£AIåº”ç”¨æ¶æ„
- ğŸš€ æŒæ¡å…¨æ ˆå¼€å‘èƒ½åŠ›
- ğŸš€ ç§¯ç´¯å·¥ç¨‹å®è·µç»éªŒ
- ğŸš€ å¼€æºè´¡çŒ®å’Œç¤¾åŒºå½±å“åŠ›

**å­¦ä¹ ä»·å€¼**:
- ğŸ“š ç³»ç»Ÿæ€§æ•´åˆå‰é¢çš„çŸ¥è¯†
- ğŸ“š ç†è®ºç»“åˆå®è·µ
- ğŸ“š åŸ¹å…»æ¶æ„æ€ç»´
- ğŸ“š æå‡é—®é¢˜è§£å†³èƒ½åŠ›

### 1.3 æœ¬æ–‡ç›®æ ‡

é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦ä¼š:

- âœ… å¦‚ä½•ä»é›¶å¼€å§‹è®¾è®¡ä¸€ä¸ªAIç¼–ç¨‹åŠ©æ‰‹
- âœ… å®Œæ•´çš„MVPå®ç°ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰
- âœ… å‰ç«¯ã€åç«¯ã€AIå¼•æ“çš„å…¨æ ˆå¼€å‘
- âœ… éƒ¨ç½²ä¸Šçº¿çš„å®Œæ•´æµç¨‹
- âœ… å•†ä¸šåŒ–çš„æ€è·¯å’Œå®šä»·ç­–ç•¥

**æœ¬æ–‡ç‰¹è‰²**:
- ğŸ“¦ å®Œæ•´å¯è¿è¡Œçš„ä»£ç ï¼ˆ8000+è¡Œï¼‰
- ğŸ¯ ä»è®¾è®¡åˆ°éƒ¨ç½²çš„å…¨æµç¨‹
- ğŸ’¡ ä¸°å¯Œçš„æ¶æ„å›¾å’Œæµç¨‹å›¾
- ğŸ”§ ç”Ÿäº§çº§çš„å·¥ç¨‹å®è·µ
- ğŸ’° å®ç”¨çš„å•†ä¸šåŒ–å»ºè®®

---

## 2. æŠ€æœ¯æ ˆé€‰æ‹©

### 2.1 æ•´ä½“æŠ€æœ¯æ¶æ„

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A1[Web UI - React]
        A2[CLI - Node.js]
        A3[VS Codeæ’ä»¶]
    end

    subgraph "åç«¯å±‚"
        B1[API Server - Express]
        B2[WebSocket Server]
        B3[ä»»åŠ¡é˜Ÿåˆ— - Bull]
    end

    subgraph "AIå±‚"
        C1[AIå¼•æ“ - Anthropic Claude]
        C2[å¤‡é€‰æ¨¡å‹ - OpenAI/æœ¬åœ°æ¨¡å‹]
        C3[Promptç®¡ç†]
    end

    subgraph "å·¥å…·å±‚"
        D1[æ–‡ä»¶ç³»ç»Ÿå·¥å…·]
        D2[ä»£ç åˆ†æå·¥å…·]
        D3[å¤–éƒ¨é›†æˆå·¥å…·]
    end

    subgraph "å­˜å‚¨å±‚"
        E1[PostgreSQL - ä¼šè¯æ•°æ®]
        E2[Redis - ç¼“å­˜]
        E3[S3 - æ–‡ä»¶å­˜å‚¨]
    end

    A1 --> B1
    A2 --> B1
    A3 --> B1

    B1 --> B3
    B2 --> B3

    B3 --> C1
    C1 --> C2

    C1 --> D1
    C1 --> D2
    C1 --> D3

    B1 --> E1
    B1 --> E2
    D1 --> E3

    style C1 fill:#ffe1f5,stroke:#333,stroke-width:2px
    style B1 fill:#e1f5ff,stroke:#333,stroke-width:2px
```

### 2.2 æŠ€æœ¯é€‰å‹è¯¦è§£

#### **å‰ç«¯æŠ€æœ¯æ ˆ**

| æŠ€æœ¯ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| **UIæ¡†æ¶** | React 18 + TypeScript | ç”Ÿæ€æˆç†Ÿã€ç±»å‹å®‰å…¨ã€æ€§èƒ½ä¼˜ç§€ |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡çº§ã€æ˜“ç”¨ã€TypeScriptå‹å¥½ |
| **UIç»„ä»¶åº“** | Ant Design / Tailwind CSS | ä¼ä¸šçº§ç»„ä»¶ / é«˜åº¦å®šåˆ¶åŒ– |
| **ä»£ç ç¼–è¾‘å™¨** | Monaco Editor | VS CodeåŒæ¬¾ã€åŠŸèƒ½å¼ºå¤§ |
| **Markdownæ¸²æŸ“** | react-markdown | æ”¯æŒä»£ç é«˜äº®ã€æ•°å­¦å…¬å¼ |
| **å®æ—¶é€šä¿¡** | Socket.IO Client | WebSocketå°è£…ã€è‡ªåŠ¨é‡è¿ |
| **HTTPå®¢æˆ·ç«¯** | Axios | æ‹¦æˆªå™¨ã€å–æ¶ˆè¯·æ±‚ã€è¶…æ—¶æ§åˆ¶ |

**ç¤ºä¾‹ package.jsonï¼ˆå‰ç«¯ï¼‰**:
```json
{
  "name": "ai-code-assistant-frontend",
  "version": "1.0.0",
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.0.0",
    "zustand": "^4.5.0",
    "antd": "^5.12.0",
    "@monaco-editor/react": "^4.6.0",
    "react-markdown": "^9.0.0",
    "socket.io-client": "^4.6.0",
    "axios": "^1.6.0",
    "tailwindcss": "^3.4.0"
  }
}
```

#### **åç«¯æŠ€æœ¯æ ˆ**

| æŠ€æœ¯ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| **è¿è¡Œæ—¶** | Node.js 20 LTS | é«˜æ€§èƒ½ã€å¤§ç”Ÿæ€ã€TypeScriptæ”¯æŒ |
| **Webæ¡†æ¶** | Express.js | æˆç†Ÿç¨³å®šã€ä¸­é—´ä»¶ä¸°å¯Œ |
| **WebSocket** | Socket.IO | è·¨æµè§ˆå™¨å…¼å®¹ã€è‡ªåŠ¨é™çº§ |
| **AI SDK** | @anthropic-ai/sdk | å®˜æ–¹SDKã€æµå¼æ”¯æŒ |
| **ä»»åŠ¡é˜Ÿåˆ—** | Bull (Redis) | å¯é çš„ä»»åŠ¡è°ƒåº¦ã€é‡è¯•æœºåˆ¶ |
| **æ•°æ®åº“ORM** | Prisma | ç±»å‹å®‰å…¨ã€è¿ç§»ç®¡ç† |
| **ç¼“å­˜** | ioredis | Rediså®¢æˆ·ç«¯ã€é›†ç¾¤æ”¯æŒ |
| **æ—¥å¿—** | Winston | æ—¥å¿—åˆ†çº§ã€å¤šè¾“å‡ºç›®æ ‡ |

**ç¤ºä¾‹ package.jsonï¼ˆåç«¯ï¼‰**:
```json
{
  "name": "ai-code-assistant-backend",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.0",
    "socket.io": "^4.6.0",
    "@anthropic-ai/sdk": "^0.15.0",
    "bull": "^4.12.0",
    "ioredis": "^5.3.0",
    "@prisma/client": "^5.8.0",
    "winston": "^3.11.0",
    "express-rate-limit": "^7.1.0",
    "helmet": "^7.1.0",
    "cors": "^2.8.5"
  },
  "devDependencies": {
    "prisma": "^5.8.0",
    "@types/express": "^4.17.21",
    "typescript": "^5.0.0",
    "tsx": "^4.7.0"
  }
}
```

#### **AIæ¨¡å‹é€‰æ‹©**

| æ¨¡å‹ | é€‚ç”¨åœºæ™¯ | æˆæœ¬ | ä¼˜ç¼ºç‚¹ |
|------|---------|------|--------|
| **Claude 3.5 Sonnet** | ä¸»åŠ›æ¨¡å‹ | $3/$15 (in/out per M) | âœ…å¼ºå¤§çš„ä»£ç èƒ½åŠ›<br>âœ…å·¥å…·è°ƒç”¨åŸç”Ÿæ”¯æŒ<br>âš ï¸éœ€è¦ç½‘ç»œ |
| **GPT-4 Turbo** | å¤‡é€‰æ–¹æ¡ˆ | $10/$30 (in/out per M) | âœ…é€šç”¨èƒ½åŠ›å¼º<br>âš ï¸æˆæœ¬è¾ƒé«˜ |
| **æœ¬åœ°æ¨¡å‹ï¼ˆOllamaï¼‰** | ç¦»çº¿åœºæ™¯ | ä»…ç¡¬ä»¶æˆæœ¬ | âœ…å®Œå…¨ç§æœ‰<br>âš ï¸èƒ½åŠ›ç›¸å¯¹å¼± |
| **Deepseek Coder** | ä»£ç ä¸“ç”¨ | $0.14/$0.28 (in/out per M) | âœ…æˆæœ¬ä½<br>âœ…ä»£ç ä¸“é¡¹ä¼˜åŒ–<br>âš ï¸é€šç”¨èƒ½åŠ›å¼± |

**æ¨èç­–ç•¥**:
- ä¸»åŠ›ï¼šClaude 3.5 Sonnetï¼ˆæœ€ä½³å¹³è¡¡ï¼‰
- å¤‡ç”¨ï¼šGPT-4 Turboï¼ˆå¤æ‚ä»»åŠ¡ï¼‰
- ç¦»çº¿ï¼šOllama + CodeLlamaï¼ˆä¼ä¸šå†…ç½‘ï¼‰
- æˆæœ¬ä¼˜åŒ–ï¼šDeepseek Coderï¼ˆç®€å•ä»»åŠ¡ï¼‰

#### **æ•°æ®åº“é€‰æ‹©**

| æ•°æ®åº“ | ç”¨é€” | ç†ç”± |
|--------|------|------|
| **PostgreSQL** | ä¸»æ•°æ®åº“ | ACIDã€JSONæ”¯æŒã€å…¨æ–‡æœç´¢ |
| **Redis** | ç¼“å­˜ + é˜Ÿåˆ— | é«˜æ€§èƒ½ã€ä¸°å¯Œæ•°æ®ç»“æ„ |
| **SQLite** | æœ¬åœ°å¼€å‘ | é›¶é…ç½®ã€æ–‡ä»¶æ•°æ®åº“ |
| **S3ï¼ˆæˆ–MinIOï¼‰** | æ–‡ä»¶å­˜å‚¨ | å¯¹è±¡å­˜å‚¨ã€CDNåŠ é€Ÿ |

### 2.3 æŠ€æœ¯æ ˆå¯¹æ¯”

**ä¸Claude Codeå®˜æ–¹çš„å¼‚åŒ**:

| ç»´åº¦ | Claude Codeå®˜æ–¹ | æˆ‘ä»¬çš„å®ç° |
|------|-----------------|-----------|
| **å‰ç«¯** | CLI only | CLI + Web UI + VS Codeæ’ä»¶ |
| **åç«¯** | æœªå¼€æºï¼ˆæ¨æµ‹Node.jsï¼‰ | Express + Socket.IO |
| **æ•°æ®åº“** | SQLiteï¼ˆæœ¬åœ°ï¼‰ | PostgreSQLï¼ˆæ”¯æŒå¤šç”¨æˆ·ï¼‰ |
| **éƒ¨ç½²** | æœ¬åœ°è¿è¡Œ | æ”¯æŒäº‘éƒ¨ç½²ï¼ˆDocker + K8sï¼‰ |
| **æ‰©å±•æ€§** | MCPåè®® | MCP + è‡ªå®šä¹‰æ’ä»¶ç³»ç»Ÿ |

**ä¼˜åŠ¿**:
- âœ… æ”¯æŒå¤šç”¨æˆ·ã€å›¢é˜Ÿåä½œ
- âœ… Web UIæ›´å‹å¥½
- âœ… äº‘ç«¯éƒ¨ç½²ã€éšæ—¶è®¿é—®
- âœ… æ›´çµæ´»çš„AIæ¨¡å‹é€‰æ‹©

**åŠ£åŠ¿**:
- âš ï¸ éœ€è¦ç»´æŠ¤æœåŠ¡å™¨
- âš ï¸ å®ç°å¤æ‚åº¦æ›´é«˜
- âš ï¸ éœ€è¦å¤„ç†å¹¶å‘å’Œæ‰©å±•

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯"
        U1[Webæµè§ˆå™¨]
        U2[CLIç»ˆç«¯]
        U3[VS Codeæ’ä»¶]
    end

    subgraph "APIç½‘å…³"
        G1[Nginxåå‘ä»£ç†]
        G2[è´Ÿè½½å‡è¡¡]
        G3[SSLç»ˆæ­¢]
    end

    subgraph "åº”ç”¨æœåŠ¡å™¨"
        A1[Express API Server]
        A2[Socket.IO Server]
        A3[è®¤è¯ä¸­é—´ä»¶]
        A4[é™æµä¸­é—´ä»¶]
    end

    subgraph "ä¸šåŠ¡å±‚"
        B1[ä¼šè¯ç®¡ç†æœåŠ¡]
        B2[AIå¼•æ“æœåŠ¡]
        B3[å·¥å…·æ‰§è¡ŒæœåŠ¡]
        B4[æ–‡ä»¶ç®¡ç†æœåŠ¡]
    end

    subgraph "ä»»åŠ¡é˜Ÿåˆ—"
        Q1[Bull Queue]
        Q2[Workerè¿›ç¨‹]
    end

    subgraph "æ•°æ®å±‚"
        D1[(PostgreSQL)]
        D2[(Redis)]
        D3[S3å­˜å‚¨]
    end

    subgraph "å¤–éƒ¨æœåŠ¡"
        E1[Anthropic API]
        E2[GitHub API]
        E3[å…¶ä»–API]
    end

    U1 --> G1
    U2 --> G1
    U3 --> G1

    G1 --> G2
    G2 --> A1
    G2 --> A2

    A1 --> A3
    A1 --> A4
    A2 --> A3

    A1 --> B1
    A1 --> B2
    A1 --> B3
    A1 --> B4

    B2 --> Q1
    Q1 --> Q2
    Q2 --> B2

    B1 --> D1
    B2 --> D2
    B4 --> D3

    B2 --> E1
    B3 --> E2
    B3 --> E3

    style B2 fill:#ffe1f5,stroke:#333,stroke-width:2px
    style Q1 fill:#e1f5ff,stroke:#333,stroke-width:2px
```

### 3.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†

#### **æ¨¡å—ä¸€ï¼šä¼šè¯ç®¡ç†ï¼ˆSession Managerï¼‰**

**èŒè´£**:
- åˆ›å»ºã€æ¢å¤ã€åˆ é™¤ä¼šè¯
- ç®¡ç†ä¼šè¯çŠ¶æ€å’Œå…ƒæ•°æ®
- å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç»´æŠ¤

**æ ¸å¿ƒæ¥å£**:
```typescript
interface SessionManager {
  // åˆ›å»ºä¼šè¯
  createSession(userId: string, config?: SessionConfig): Promise<Session>;

  // æ¢å¤ä¼šè¯
  getSession(sessionId: string): Promise<Session>;

  // æ›´æ–°ä¼šè¯
  updateSession(sessionId: string, data: Partial<Session>): Promise<void>;

  // åˆ é™¤ä¼šè¯
  deleteSession(sessionId: string): Promise<void>;

  // åˆ—å‡ºä¼šè¯
  listSessions(userId: string, options?: ListOptions): Promise<Session[]>;
}

interface Session {
  id: string;
  userId: string;
  title: string;
  messages: Message[];
  context: ContextData;
  metadata: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
}
```

#### **æ¨¡å—äºŒï¼šAIå¼•æ“ï¼ˆAI Engineï¼‰**

**èŒè´£**:
- ä¸AIæ¨¡å‹é€šä¿¡
- å¤„ç†æµå¼å“åº”
- ç®¡ç†å·¥å…·è°ƒç”¨
- ä¸Šä¸‹æ–‡ä¼˜åŒ–

**æ ¸å¿ƒæ¥å£**:
```typescript
interface AIEngine {
  // å¤„ç†æ¶ˆæ¯
  processMessage(
    session: Session,
    message: string,
    options?: ProcessOptions
  ): AsyncIterable<AIResponse>;

  // æ‰§è¡Œå·¥å…·
  executeTool(
    toolName: string,
    params: any
  ): Promise<ToolResult>;

  // ç®¡ç†ä¸Šä¸‹æ–‡
  optimizeContext(
    messages: Message[],
    tokenBudget: number
  ): Message[];
}

interface AIResponse {
  type: 'text' | 'tool_use' | 'error';
  content: string;
  toolCall?: ToolCall;
}
```

#### **æ¨¡å—ä¸‰ï¼šå·¥å…·ç³»ç»Ÿï¼ˆTool Systemï¼‰**

**èŒè´£**:
- å·¥å…·æ³¨å†Œå’Œç®¡ç†
- å·¥å…·å‚æ•°éªŒè¯
- å·¥å…·æ‰§è¡Œå’Œç»“æœæ ¼å¼åŒ–
- å·¥å…·æƒé™æ§åˆ¶

**æ ¸å¿ƒæ¥å£**:
```typescript
interface ToolSystem {
  // æ³¨å†Œå·¥å…·
  registerTool(tool: ToolDefinition, executor: ToolExecutor): void;

  // æ‰§è¡Œå·¥å…·
  executeTool(name: string, params: any): Promise<ToolResult>;

  // è·å–æ‰€æœ‰å·¥å…·
  getAllTools(): ToolDefinition[];

  // æ£€æŸ¥æƒé™
  checkPermission(toolName: string, userId: string): boolean;
}

interface ToolDefinition {
  name: string;
  description: string;
  input_schema: JSONSchema;
  requiredPermissions?: string[];
}
```

#### **æ¨¡å—å››ï¼šæ–‡ä»¶ç®¡ç†ï¼ˆFile Managerï¼‰**

**èŒè´£**:
- å·¥ä½œåŒºæ–‡ä»¶ç®¡ç†
- æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
- ç‰ˆæœ¬æ§åˆ¶é›†æˆ
- æ–‡ä»¶æœç´¢å’Œç´¢å¼•

**æ ¸å¿ƒæ¥å£**:
```typescript
interface FileManager {
  // è¯»å–æ–‡ä»¶
  readFile(path: string): Promise<string>;

  // å†™å…¥æ–‡ä»¶
  writeFile(path: string, content: string): Promise<void>;

  // åˆ—å‡ºæ–‡ä»¶
  listFiles(directory: string, pattern?: string): Promise<FileInfo[]>;

  // æœç´¢å†…å®¹
  searchContent(pattern: string, options?: SearchOptions): Promise<SearchResult[]>;
}
```

### 3.3 æ•°æ®æµè®¾è®¡

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant API as API Server
    participant Session as ä¼šè¯ç®¡ç†
    participant AI as AIå¼•æ“
    participant Tool as å·¥å…·ç³»ç»Ÿ
    participant DB as æ•°æ®åº“

    Client->>API: å‘é€æ¶ˆæ¯
    API->>Session: è·å–ä¼šè¯
    Session->>DB: æŸ¥è¯¢ä¼šè¯æ•°æ®
    DB-->>Session: è¿”å›ä¼šè¯
    Session-->>API: ä¼šè¯å¯¹è±¡

    API->>AI: å¤„ç†æ¶ˆæ¯
    Note over AI: ä¼˜åŒ–ä¸Šä¸‹æ–‡<br/>æ„é€ APIè¯·æ±‚

    AI->>AI: è°ƒç”¨Claude API

    loop æµå¼å“åº”
        AI-->>Client: SSE: æ–‡æœ¬ç‰‡æ®µ
    end

    alt éœ€è¦å·¥å…·è°ƒç”¨
        AI->>Tool: æ‰§è¡Œå·¥å…·
        Tool->>Tool: å‚æ•°éªŒè¯
        Tool->>Tool: æ‰§è¡Œæ“ä½œ
        Tool-->>AI: å·¥å…·ç»“æœ

        AI->>AI: ç»§ç»­ç”Ÿæˆ
        loop ç»§ç»­æµå¼å“åº”
            AI-->>Client: SSE: åç»­æ–‡æœ¬
        end
    end

    API->>Session: ä¿å­˜å¯¹è¯
    Session->>DB: æ›´æ–°ä¼šè¯
    DB-->>Session: ç¡®è®¤
    Session-->>API: å®Œæˆ
    API-->>Client: ç»“æŸæ ‡è®°
```

---

## 4. MVPåŠŸèƒ½å®ç°

### 4.1 é¡¹ç›®ç»“æ„

```
ai-code-assistant/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ frontend/                 # å‰ç«¯åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/      # UIç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/           # é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/           # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ store/           # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # APIæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ types/           # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â”œâ”€â”€ backend/                  # åç«¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts        # æœåŠ¡å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/          # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ tools/           # å·¥å…·å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ middlewares/     # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ types/           # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ prisma/              # æ•°æ®åº“Schema
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â””â”€â”€ shared/                   # å…±äº«ä»£ç 
â”‚       â”œâ”€â”€ types/               # å…±äº«ç±»å‹
â”‚       â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ docker/                       # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile.frontend
â”‚   â”œâ”€â”€ Dockerfile.backend
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”œâ”€â”€ scripts/                      # è„šæœ¬
â”œâ”€â”€ .github/                      # GitHub Actions
â”œâ”€â”€ package.json                  # Monorepoé…ç½®
â””â”€â”€ README.md
```

### 4.2 æ ¸å¿ƒå¼•æ“å®ç°

#### **AIå¼•æ“æ ¸å¿ƒä»£ç **

```typescript
// packages/backend/src/services/ai-engine.ts

import Anthropic from '@anthropic-ai/sdk';
import { EventEmitter } from 'events';
import { ToolSystem } from './tool-system';
import { ContextManager } from './context-manager';

/**
 * AIå¼•æ“é…ç½®
 */
interface AIEngineConfig {
  apiKey: string;
  model: string;
  maxTokens: number;
  temperature: number;
}

/**
 * æ¶ˆæ¯ç±»å‹
 */
interface Message {
  role: 'user' | 'assistant' | 'system';
  content: string | ContentBlock[];
}

interface ContentBlock {
  type: 'text' | 'tool_use' | 'tool_result';
  text?: string;
  id?: string;
  name?: string;
  input?: any;
  content?: any;
}

/**
 * AIå“åº”äº‹ä»¶
 */
interface AIResponseEvent {
  type: 'start' | 'text' | 'tool_use' | 'end' | 'error';
  data?: any;
}

/**
 * AIå¼•æ“
 */
export class AIEngine extends EventEmitter {
  private client: Anthropic;
  private config: AIEngineConfig;
  private toolSystem: ToolSystem;
  private contextManager: ContextManager;

  constructor(
    config: AIEngineConfig,
    toolSystem: ToolSystem,
    contextManager: ContextManager
  ) {
    super();
    this.config = config;
    this.client = new Anthropic({
      apiKey: config.apiKey
    });
    this.toolSystem = toolSystem;
    this.contextManager = contextManager;
  }

  /**
   * å¤„ç†æ¶ˆæ¯ï¼ˆæµå¼å“åº”ï¼‰
   */
  async *processMessage(
    messages: Message[],
    sessionId: string
  ): AsyncGenerator<AIResponseEvent> {
    try {
      // ä¼˜åŒ–ä¸Šä¸‹æ–‡
      const optimizedMessages = await this.contextManager.optimize(
        messages,
        this.config.maxTokens
      );

      // è·å–å¯ç”¨å·¥å…·
      const tools = this.toolSystem.getAllTools();

      // å‘é€å¼€å§‹äº‹ä»¶
      yield { type: 'start' };

      // è°ƒç”¨AI API
      const stream = await this.client.messages.create({
        model: this.config.model,
        max_tokens: this.config.maxTokens,
        temperature: this.config.temperature,
        messages: optimizedMessages,
        tools: tools,
        stream: true
      });

      // æ”¶é›†å®Œæ•´å“åº”
      let fullResponse = '';
      const toolCalls: any[] = [];

      // å¤„ç†æµå¼å“åº”
      for await (const chunk of stream) {
        if (chunk.type === 'content_block_start') {
          // å†…å®¹å—å¼€å§‹
          continue;
        } else if (chunk.type === 'content_block_delta') {
          if (chunk.delta.type === 'text_delta') {
            // æ–‡æœ¬å¢é‡
            const text = chunk.delta.text;
            fullResponse += text;
            yield {
              type: 'text',
              data: { text }
            };
          } else if (chunk.delta.type === 'input_json_delta') {
            // å·¥å…·è°ƒç”¨å‚æ•°
            continue;
          }
        } else if (chunk.type === 'content_block_stop') {
          // å†…å®¹å—ç»“æŸ
          continue;
        } else if (chunk.type === 'message_delta') {
          if (chunk.delta.stop_reason === 'tool_use') {
            // AIè¯·æ±‚è°ƒç”¨å·¥å…·
            // å·¥å…·è°ƒç”¨ä¿¡æ¯åœ¨ä¹‹å‰çš„chunksä¸­å·²æ”¶é›†
          }
        } else if (chunk.type === 'message_stop') {
          // æ¶ˆæ¯ç»“æŸ
          break;
        }
      }

      // æ£€æŸ¥æ˜¯å¦æœ‰å·¥å…·è°ƒç”¨
      if (stream.finalMessage?.stop_reason === 'tool_use') {
        // æå–å·¥å…·è°ƒç”¨
        const toolUses = stream.finalMessage.content.filter(
          (block: any) => block.type === 'tool_use'
        );

        // æ‰§è¡Œæ‰€æœ‰å·¥å…·
        const toolResults = await this.executeTools(toolUses);

        // å‘é€å·¥å…·è°ƒç”¨äº‹ä»¶
        yield {
          type: 'tool_use',
          data: {
            toolCalls: toolUses,
            toolResults
          }
        };

        // å°†å·¥å…·ç»“æœè¿”å›ç»™AIï¼Œç»§ç»­å¯¹è¯
        const newMessages = [
          ...optimizedMessages,
          {
            role: 'assistant' as const,
            content: stream.finalMessage.content
          },
          {
            role: 'user' as const,
            content: toolResults
          }
        ];

        // é€’å½’è°ƒç”¨ï¼Œç»§ç»­ç”Ÿæˆ
        yield* this.processMessage(newMessages, sessionId);
      } else {
        // æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œå¯¹è¯ç»“æŸ
        yield { type: 'end' };
      }
    } catch (error) {
      console.error('AI Engine Error:', error);
      yield {
        type: 'error',
        data: { message: error.message }
      };
    }
  }

  /**
   * æ‰§è¡Œå·¥å…·è°ƒç”¨
   */
  private async executeTools(toolUses: any[]): Promise<any[]> {
    const results = await Promise.all(
      toolUses.map(async (toolUse) => {
        try {
          // æ‰§è¡Œå·¥å…·
          const result = await this.toolSystem.executeTool(
            toolUse.name,
            toolUse.input
          );

          return {
            type: 'tool_result',
            tool_use_id: toolUse.id,
            content: result.success ? result.content : result.error
          };
        } catch (error) {
          return {
            type: 'tool_result',
            tool_use_id: toolUse.id,
            content: `å·¥å…·æ‰§è¡Œå¤±è´¥: ${error.message}`,
            is_error: true
          };
        }
      })
    );

    return results;
  }

  /**
   * å¤„ç†å•è½®æ¶ˆæ¯ï¼ˆéæµå¼ï¼‰
   */
  async processMessageSync(
    messages: Message[],
    sessionId: string
  ): Promise<string> {
    let fullResponse = '';

    for await (const event of this.processMessage(messages, sessionId)) {
      if (event.type === 'text') {
        fullResponse += event.data.text;
      }
    }

    return fullResponse;
  }
}
```

#### **å·¥å…·ç³»ç»Ÿå®ç°**

```typescript
// packages/backend/src/services/tool-system.ts

import { ToolDefinition, ToolExecutor, ToolResult } from '../types/tool';
import Ajv from 'ajv';

/**
 * å·¥å…·ç³»ç»Ÿ
 */
export class ToolSystem {
  private tools: Map<string, { definition: ToolDefinition; executor: ToolExecutor }> = new Map();
  private ajv = new Ajv({ allErrors: true });

  /**
   * æ³¨å†Œå·¥å…·
   */
  registerTool(definition: ToolDefinition, executor: ToolExecutor): void {
    this.tools.set(definition.name, { definition, executor });
    console.log(`Tool registered: ${definition.name}`);
  }

  /**
   * è·å–æ‰€æœ‰å·¥å…·å®šä¹‰
   */
  getAllTools(): ToolDefinition[] {
    return Array.from(this.tools.values()).map(t => t.definition);
  }

  /**
   * è·å–å·¥å…·å®šä¹‰
   */
  getTool(name: string): ToolDefinition | undefined {
    return this.tools.get(name)?.definition;
  }

  /**
   * æ‰§è¡Œå·¥å…·
   */
  async executeTool(name: string, params: any): Promise<ToolResult> {
    const tool = this.tools.get(name);

    if (!tool) {
      return {
        success: false,
        error: `Tool not found: ${name}`
      };
    }

    try {
      // å‚æ•°éªŒè¯
      const validation = this.validateParams(tool.definition.input_schema, params);
      if (!validation.valid) {
        return {
          success: false,
          error: `Invalid parameters: ${validation.errors?.join(', ')}`
        };
      }

      // æ‰§è¡Œå·¥å…·
      const result = await tool.executor.execute(params);

      return {
        success: true,
        content: result
      };
    } catch (error) {
      console.error(`Tool execution error (${name}):`, error);
      return {
        success: false,
        error: `Execution failed: ${error.message}`
      };
    }
  }

  /**
   * éªŒè¯å‚æ•°
   */
  private validateParams(schema: any, params: any): { valid: boolean; errors?: string[] } {
    const validate = this.ajv.compile(schema);
    const valid = validate(params);

    if (!valid) {
      const errors = validate.errors?.map(err =>
        `${err.instancePath} ${err.message}`
      );
      return { valid: false, errors };
    }

    return { valid: true };
  }
}
```

#### **å†…ç½®å·¥å…·å®ç°**

```typescript
// packages/backend/src/tools/file-tools.ts

import fs from 'fs/promises';
import path from 'path';
import { ToolExecutor, ToolDefinition } from '../types/tool';

/**
 * Readå·¥å…·
 */
export class ReadToolExecutor implements ToolExecutor {
  async execute(params: { file_path: string; offset?: number; limit?: number }): Promise<string> {
    try {
      const content = await fs.readFile(params.file_path, 'utf-8');
      const lines = content.split('\n');

      const offset = params.offset || 0;
      const limit = params.limit || lines.length;

      const selectedLines = lines.slice(offset, offset + limit);

      // æ·»åŠ è¡Œå·
      const numberedLines = selectedLines.map(
        (line, idx) => `${offset + idx + 1}\t${line}`
      );

      return numberedLines.join('\n');
    } catch (error) {
      throw new Error(`Failed to read file: ${error.message}`);
    }
  }
}

export const readToolDefinition: ToolDefinition = {
  name: 'read_file',
  description: 'Read a file from the filesystem',
  input_schema: {
    type: 'object',
    properties: {
      file_path: {
        type: 'string',
        description: 'The absolute path to the file'
      },
      offset: {
        type: 'number',
        description: 'Line number to start reading from (optional)'
      },
      limit: {
        type: 'number',
        description: 'Number of lines to read (optional)'
      }
    },
    required: ['file_path']
  }
};

/**
 * Writeå·¥å…·
 */
export class WriteToolExecutor implements ToolExecutor {
  async execute(params: { file_path: string; content: string }): Promise<string> {
    try {
      // ç¡®ä¿ç›®å½•å­˜åœ¨
      await fs.mkdir(path.dirname(params.file_path), { recursive: true });

      // å†™å…¥æ–‡ä»¶
      await fs.writeFile(params.file_path, params.content, 'utf-8');

      return `File written successfully: ${params.file_path}`;
    } catch (error) {
      throw new Error(`Failed to write file: ${error.message}`);
    }
  }
}

export const writeToolDefinition: ToolDefinition = {
  name: 'write_file',
  description: 'Write content to a file',
  input_schema: {
    type: 'object',
    properties: {
      file_path: {
        type: 'string',
        description: 'The absolute path to the file'
      },
      content: {
        type: 'string',
        description: 'The content to write'
      }
    },
    required: ['file_path', 'content']
  }
};

/**
 * Editå·¥å…·
 */
export class EditToolExecutor implements ToolExecutor {
  async execute(params: {
    file_path: string;
    old_string: string;
    new_string: string;
    replace_all?: boolean;
  }): Promise<string> {
    try {
      // è¯»å–æ–‡ä»¶
      let content = await fs.readFile(params.file_path, 'utf-8');

      // æ£€æŸ¥old_stringæ˜¯å¦å­˜åœ¨
      if (!content.includes(params.old_string)) {
        throw new Error('old_string not found in file');
      }

      // æ›¿æ¢
      if (params.replace_all) {
        content = content.split(params.old_string).join(params.new_string);
      } else {
        // åªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…
        content = content.replace(params.old_string, params.new_string);
      }

      // å†™å›æ–‡ä»¶
      await fs.writeFile(params.file_path, content, 'utf-8');

      return `File edited successfully: ${params.file_path}`;
    } catch (error) {
      throw new Error(`Failed to edit file: ${error.message}`);
    }
  }
}

export const editToolDefinition: ToolDefinition = {
  name: 'edit_file',
  description: 'Edit a file by replacing text',
  input_schema: {
    type: 'object',
    properties: {
      file_path: {
        type: 'string',
        description: 'The absolute path to the file'
      },
      old_string: {
        type: 'string',
        description: 'The text to replace'
      },
      new_string: {
        type: 'string',
        description: 'The replacement text'
      },
      replace_all: {
        type: 'boolean',
        description: 'Replace all occurrences (default: false)',
        default: false
      }
    },
    required: ['file_path', 'old_string', 'new_string']
  }
};
```

### 4.3 APIæœåŠ¡å™¨å®ç°

```typescript
// packages/backend/src/server.ts

import express from 'express';
import { createServer } from 'http';
import { Server as SocketServer } from 'socket.io';
import cors from 'cors';
import helmet from 'helmet';
import rateLimit from 'express-rate-limit';
import { PrismaClient } from '@prisma/client';
import { AIEngine } from './services/ai-engine';
import { ToolSystem } from './services/tool-system';
import { ContextManager } from './services/context-manager';
import { authMiddleware } from './middlewares/auth';
import { setupRoutes } from './routes';
import { setupSocketHandlers } from './socket';
import * as FileTools from './tools/file-tools';

// é…ç½®
const PORT = process.env.PORT || 3000;
const ANTHROPIC_API_KEY = process.env.ANTHROPIC_API_KEY!;

// åˆ›å»ºExpressåº”ç”¨
const app = express();
const httpServer = createServer(app);
const io = new SocketServer(httpServer, {
  cors: {
    origin: process.env.FRONTEND_URL || 'http://localhost:5173',
    methods: ['GET', 'POST']
  }
});

// æ•°æ®åº“
const prisma = new PrismaClient();

// ä¸­é—´ä»¶
app.use(helmet());
app.use(cors());
app.use(express.json());

// é™æµ
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100 // æœ€å¤š100ä¸ªè¯·æ±‚
});
app.use(limiter);

// åˆå§‹åŒ–æœåŠ¡
const toolSystem = new ToolSystem();
const contextManager = new ContextManager();
const aiEngine = new AIEngine(
  {
    apiKey: ANTHROPIC_API_KEY,
    model: 'claude-3-5-sonnet-20250929',
    maxTokens: 8000,
    temperature: 0.7
  },
  toolSystem,
  contextManager
);

// æ³¨å†Œå†…ç½®å·¥å…·
toolSystem.registerTool(
  FileTools.readToolDefinition,
  new FileTools.ReadToolExecutor()
);
toolSystem.registerTool(
  FileTools.writeToolDefinition,
  new FileTools.WriteToolExecutor()
);
toolSystem.registerTool(
  FileTools.editToolDefinition,
  new FileTools.EditToolExecutor()
);

// è®¾ç½®è·¯ç”±
setupRoutes(app, {
  prisma,
  aiEngine,
  toolSystem
});

// è®¾ç½®Socket.IOå¤„ç†å™¨
setupSocketHandlers(io, {
  prisma,
  aiEngine,
  authMiddleware
});

// å¥åº·æ£€æŸ¥
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// å¯åŠ¨æœåŠ¡å™¨
httpServer.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

// ä¼˜é›…å…³é—­
process.on('SIGTERM', async () => {
  console.log('SIGTERM received, shutting down gracefully');
  await prisma.$disconnect();
  httpServer.close(() => {
    console.log('Server closed');
    process.exit(0);
  });
});
```

#### **Socket.IOå¤„ç†å™¨**

```typescript
// packages/backend/src/socket/index.ts

import { Server as SocketServer, Socket } from 'socket.io';
import { AIEngine } from '../services/ai-engine';
import { PrismaClient } from '@prisma/client';

interface SocketData {
  userId: string;
  sessionId?: string;
}

/**
 * è®¾ç½®Socket.IOå¤„ç†å™¨
 */
export function setupSocketHandlers(
  io: SocketServer,
  deps: {
    prisma: PrismaClient;
    aiEngine: AIEngine;
    authMiddleware: any;
  }
) {
  // è®¤è¯ä¸­é—´ä»¶
  io.use(async (socket, next) => {
    const token = socket.handshake.auth.token;
    if (!token) {
      return next(new Error('Authentication error'));
    }

    try {
      const user = await deps.authMiddleware.verifyToken(token);
      socket.data.userId = user.id;
      next();
    } catch (error) {
      next(new Error('Authentication error'));
    }
  });

  // è¿æ¥å¤„ç†
  io.on('connection', (socket: Socket) => {
    console.log(`Client connected: ${socket.id}`);

    // å‘é€æ¶ˆæ¯
    socket.on('send_message', async (data: {
      sessionId: string;
      message: string;
    }) => {
      try {
        const { sessionId, message } = data;

        // è·å–ä¼šè¯
        const session = await deps.prisma.session.findUnique({
          where: { id: sessionId },
          include: { messages: true }
        });

        if (!session || session.userId !== socket.data.userId) {
          socket.emit('error', { message: 'Session not found' });
          return;
        }

        // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
        await deps.prisma.message.create({
          data: {
            sessionId: sessionId,
            role: 'user',
            content: message
          }
        });

        // æ„é€ æ¶ˆæ¯åˆ—è¡¨
        const messages = [
          ...session.messages.map(m => ({
            role: m.role as 'user' | 'assistant',
            content: m.content
          })),
          { role: 'user' as const, content: message }
        ];

        // å¤„ç†æ¶ˆæ¯ï¼ˆæµå¼ï¼‰
        let assistantMessage = '';

        for await (const event of deps.aiEngine.processMessage(messages, sessionId)) {
          if (event.type === 'text') {
            assistantMessage += event.data.text;
            // å‘é€æ–‡æœ¬ç‰‡æ®µç»™å®¢æˆ·ç«¯
            socket.emit('message_chunk', {
              type: 'text',
              content: event.data.text
            });
          } else if (event.type === 'tool_use') {
            // å‘é€å·¥å…·è°ƒç”¨ä¿¡æ¯
            socket.emit('message_chunk', {
              type: 'tool_use',
              content: event.data
            });
          } else if (event.type === 'end') {
            // ä¿å­˜AIæ¶ˆæ¯
            await deps.prisma.message.create({
              data: {
                sessionId: sessionId,
                role: 'assistant',
                content: assistantMessage
              }
            });

            // å‘é€ç»“æŸæ ‡è®°
            socket.emit('message_end');
          } else if (event.type === 'error') {
            socket.emit('error', { message: event.data.message });
          }
        }
      } catch (error) {
        console.error('Socket error:', error);
        socket.emit('error', { message: error.message });
      }
    });

    // æ–­å¼€è¿æ¥
    socket.on('disconnect', () => {
      console.log(`Client disconnected: ${socket.id}`);
    });
  });
}
```

### 4.4 å‰ç«¯å®ç°

#### **çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰**

```typescript
// packages/frontend/src/store/chat-store.ts

import { create } from 'zustand';
import { io, Socket } from 'socket.io-client';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface ChatStore {
  // çŠ¶æ€
  socket: Socket | null;
  sessionId: string | null;
  messages: Message[];
  isConnected: boolean;
  isStreaming: boolean;
  currentChunk: string;

  // æ“ä½œ
  connect: (token: string) => void;
  disconnect: () => void;
  sendMessage: (content: string) => void;
  clearMessages: () => void;
}

export const useChatStore = create<ChatStore>((set, get) => ({
  // åˆå§‹çŠ¶æ€
  socket: null,
  sessionId: null,
  messages: [],
  isConnected: false,
  isStreaming: false,
  currentChunk: '',

  // è¿æ¥Socket
  connect: (token: string) => {
    const socket = io('http://localhost:3000', {
      auth: { token }
    });

    socket.on('connect', () => {
      console.log('Connected to server');
      set({ isConnected: true });
    });

    socket.on('disconnect', () => {
      console.log('Disconnected from server');
      set({ isConnected: false });
    });

    // æ¥æ”¶æ¶ˆæ¯ç‰‡æ®µ
    socket.on('message_chunk', (data: any) => {
      if (data.type === 'text') {
        set(state => ({
          isStreaming: true,
          currentChunk: state.currentChunk + data.content
        }));
      }
    });

    // æ¶ˆæ¯ç»“æŸ
    socket.on('message_end', () => {
      const { currentChunk, messages } = get();
      set({
        messages: [
          ...messages,
          {
            id: Date.now().toString(),
            role: 'assistant',
            content: currentChunk,
            timestamp: new Date()
          }
        ],
        currentChunk: '',
        isStreaming: false
      });
    });

    // é”™è¯¯å¤„ç†
    socket.on('error', (error: any) => {
      console.error('Socket error:', error);
      alert(`Error: ${error.message}`);
      set({ isStreaming: false });
    });

    set({ socket });
  },

  // æ–­å¼€è¿æ¥
  disconnect: () => {
    const { socket } = get();
    if (socket) {
      socket.disconnect();
      set({ socket: null, isConnected: false });
    }
  },

  // å‘é€æ¶ˆæ¯
  sendMessage: (content: string) => {
    const { socket, sessionId, messages } = get();

    if (!socket || !sessionId) {
      console.error('Not connected');
      return;
    }

    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    const userMessage: Message = {
      id: Date.now().toString(),
      role: 'user',
      content,
      timestamp: new Date()
    };

    set({
      messages: [...messages, userMessage],
      currentChunk: '',
      isStreaming: true
    });

    // å‘é€åˆ°æœåŠ¡å™¨
    socket.emit('send_message', {
      sessionId,
      message: content
    });
  },

  // æ¸…ç©ºæ¶ˆæ¯
  clearMessages: () => {
    set({ messages: [], currentChunk: '' });
  }
}));
```

#### **èŠå¤©ç•Œé¢ç»„ä»¶**

```typescript
// packages/frontend/src/components/ChatInterface.tsx

import React, { useEffect, useRef } from 'react';
import { useChatStore } from '../store/chat-store';
import ReactMarkdown from 'react-markdown';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';

export const ChatInterface: React.FC = () => {
  const {
    messages,
    currentChunk,
    isStreaming,
    isConnected,
    sendMessage
  } = useChatStore();

  const [input, setInput] = React.useState('');
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages, currentChunk]);

  const handleSend = () => {
    if (!input.trim() || !isConnected || isStreaming) return;

    sendMessage(input);
    setInput('');
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <div className="flex flex-col h-screen bg-gray-900">
      {/* å¤´éƒ¨ */}
      <header className="bg-gray-800 border-b border-gray-700 p-4">
        <div className="flex items-center justify-between">
          <h1 className="text-xl font-bold text-white">
            AI Code Assistant
          </h1>
          <div className="flex items-center gap-2">
            <span className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-red-500'}`} />
            <span className="text-sm text-gray-400">
              {isConnected ? 'Connected' : 'Disconnected'}
            </span>
          </div>
        </div>
      </header>

      {/* æ¶ˆæ¯åˆ—è¡¨ */}
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.map((message) => (
          <MessageBubble key={message.id} message={message} />
        ))}

        {/* å½“å‰æ­£åœ¨ç”Ÿæˆçš„æ¶ˆæ¯ */}
        {isStreaming && currentChunk && (
          <MessageBubble
            message={{
              id: 'streaming',
              role: 'assistant',
              content: currentChunk,
              timestamp: new Date()
            }}
            isStreaming
          />
        )}

        <div ref={messagesEndRef} />
      </div>

      {/* è¾“å…¥æ¡† */}
      <div className="bg-gray-800 border-t border-gray-700 p-4">
        <div className="flex gap-2">
          <textarea
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="è¾“å…¥æ¶ˆæ¯... (Shift+Enteræ¢è¡Œ)"
            className="flex-1 bg-gray-700 text-white rounded-lg p-3 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
            rows={3}
            disabled={!isConnected || isStreaming}
          />
          <button
            onClick={handleSend}
            disabled={!isConnected || isStreaming || !input.trim()}
            className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            å‘é€
          </button>
        </div>
      </div>
    </div>
  );
};

/**
 * æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
 */
const MessageBubble: React.FC<{
  message: {
    role: 'user' | 'assistant';
    content: string;
  };
  isStreaming?: boolean;
}> = ({ message, isStreaming }) => {
  const isUser = message.role === 'user';

  return (
    <div className={`flex ${isUser ? 'justify-end' : 'justify-start'}`}>
      <div
        className={`max-w-3xl rounded-lg p-4 ${
          isUser
            ? 'bg-blue-600 text-white'
            : 'bg-gray-800 text-gray-100'
        }`}
      >
        {isUser ? (
          <div className="whitespace-pre-wrap">{message.content}</div>
        ) : (
          <ReactMarkdown
            className="prose prose-invert max-w-none"
            components={{
              code({ node, inline, className, children, ...props }) {
                const match = /language-(\w+)/.exec(className || '');
                return !inline && match ? (
                  <SyntaxHighlighter
                    style={vscDarkPlus}
                    language={match[1]}
                    PreTag="div"
                    {...props}
                  >
                    {String(children).replace(/\n$/, '')}
                  </SyntaxHighlighter>
                ) : (
                  <code className={className} {...props}>
                    {children}
                  </code>
                );
              }
            }}
          >
            {message.content}
          </ReactMarkdown>
        )}

        {isStreaming && (
          <span className="inline-block w-2 h-4 bg-gray-400 animate-pulse ml-1" />
        )}
      </div>
    </div>
  );
};
```

### 4.5 æ•°æ®åº“Schema

```prisma
// packages/backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ç”¨æˆ·æ¨¡å‹
model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String?
  password  String
  apiKey    String?   @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  sessions  Session[]

  @@map("users")
}

// ä¼šè¯æ¨¡å‹
model Session {
  id        String    @id @default(uuid())
  title     String    @default("New Session")
  userId    String
  context   Json?
  metadata  Json?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages  Message[]

  @@index([userId])
  @@map("sessions")
}

// æ¶ˆæ¯æ¨¡å‹
model Message {
  id        String   @id @default(uuid())
  sessionId String
  role      String   // 'user' | 'assistant' | 'system'
  content   String   @db.Text
  metadata  Json?
  createdAt DateTime @default(now())

  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("messages")
}

// æ–‡ä»¶æ¨¡å‹
model File {
  id        String   @id @default(uuid())
  path      String
  content   String   @db.Text
  size      Int
  mimeType  String?
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, path])
  @@index([userId])
  @@map("files")
}

// APIä½¿ç”¨è®°å½•
model APIUsage {
  id            String   @id @default(uuid())
  userId        String
  model         String
  inputTokens   Int
  outputTokens  Int
  cost          Decimal  @db.Decimal(10, 6)
  createdAt     DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@map("api_usage")
}
```

---

## 5. é«˜çº§ç‰¹æ€§

### 5.1 å·¥å…·æ‰©å±•æœºåˆ¶

#### **æ’ä»¶ç³»ç»Ÿè®¾è®¡**

```typescript
// packages/backend/src/plugins/plugin-system.ts

/**
 * æ’ä»¶æ¥å£
 */
export interface Plugin {
  name: string;
  version: string;
  description: string;

  // ç”Ÿå‘½å‘¨æœŸé’©å­
  onInstall?(): Promise<void>;
  onEnable?(): Promise<void>;
  onDisable?(): Promise<void>;
  onUninstall?(): Promise<void>;

  // å·¥å…·æ³¨å†Œ
  getTools?(): ToolDefinition[];
  getExecutors?(): Map<string, ToolExecutor>;

  // è‡ªå®šä¹‰è·¯ç”±
  getRoutes?(): Array<{
    method: string;
    path: string;
    handler: (req: any, res: any) => void;
  }>;
}

/**
 * æ’ä»¶ç®¡ç†å™¨
 */
export class PluginManager {
  private plugins: Map<string, Plugin> = new Map();
  private enabledPlugins: Set<string> = new Set();

  /**
   * å®‰è£…æ’ä»¶
   */
  async installPlugin(plugin: Plugin): Promise<void> {
    if (this.plugins.has(plugin.name)) {
      throw new Error(`Plugin already installed: ${plugin.name}`);
    }

    // æ‰§è¡Œå®‰è£…é’©å­
    if (plugin.onInstall) {
      await plugin.onInstall();
    }

    this.plugins.set(plugin.name, plugin);
    console.log(`Plugin installed: ${plugin.name}`);
  }

  /**
   * å¯ç”¨æ’ä»¶
   */
  async enablePlugin(name: string, toolSystem: ToolSystem): Promise<void> {
    const plugin = this.plugins.get(name);
    if (!plugin) {
      throw new Error(`Plugin not found: ${name}`);
    }

    // æ³¨å†Œå·¥å…·
    if (plugin.getTools && plugin.getExecutors) {
      const tools = plugin.getTools();
      const executors = plugin.getExecutors();

      tools.forEach(tool => {
        const executor = executors.get(tool.name);
        if (executor) {
          toolSystem.registerTool(tool, executor);
        }
      });
    }

    // æ‰§è¡Œå¯ç”¨é’©å­
    if (plugin.onEnable) {
      await plugin.onEnable();
    }

    this.enabledPlugins.add(name);
    console.log(`Plugin enabled: ${name}`);
  }

  /**
   * ç¦ç”¨æ’ä»¶
   */
  async disablePlugin(name: string): Promise<void> {
    const plugin = this.plugins.get(name);
    if (!plugin) {
      throw new Error(`Plugin not found: ${name}`);
    }

    // æ‰§è¡Œç¦ç”¨é’©å­
    if (plugin.onDisable) {
      await plugin.onDisable();
    }

    this.enabledPlugins.delete(name);
    console.log(`Plugin disabled: ${name}`);
  }

  /**
   * å¸è½½æ’ä»¶
   */
  async uninstallPlugin(name: string): Promise<void> {
    const plugin = this.plugins.get(name);
    if (!plugin) {
      throw new Error(`Plugin not found: ${name}`);
    }

    // å…ˆç¦ç”¨
    if (this.enabledPlugins.has(name)) {
      await this.disablePlugin(name);
    }

    // æ‰§è¡Œå¸è½½é’©å­
    if (plugin.onUninstall) {
      await plugin.onUninstall();
    }

    this.plugins.delete(name);
    console.log(`Plugin uninstalled: ${name}`);
  }

  /**
   * åˆ—å‡ºæ‰€æœ‰æ’ä»¶
   */
  listPlugins(): Array<{ name: string; enabled: boolean }> {
    return Array.from(this.plugins.keys()).map(name => ({
      name,
      enabled: this.enabledPlugins.has(name)
    }));
  }
}
```

#### **ç¤ºä¾‹æ’ä»¶ï¼šGité›†æˆ**

```typescript
// packages/backend/src/plugins/git-plugin.ts

import { Plugin, ToolDefinition, ToolExecutor } from './plugin-system';
import { simpleGit, SimpleGit } from 'simple-git';

/**
 * Gitæ’ä»¶
 */
export class GitPlugin implements Plugin {
  name = 'git-integration';
  version = '1.0.0';
  description = 'Git version control integration';

  private git: SimpleGit = simpleGit();

  async onInstall(): Promise<void> {
    console.log('Git plugin installed');
  }

  async onEnable(): Promise<void> {
    console.log('Git plugin enabled');
  }

  getTools(): ToolDefinition[] {
    return [
      {
        name: 'git_status',
        description: 'Get git status of the current repository',
        input_schema: {
          type: 'object',
          properties: {},
          required: []
        }
      },
      {
        name: 'git_commit',
        description: 'Create a git commit',
        input_schema: {
          type: 'object',
          properties: {
            message: {
              type: 'string',
              description: 'Commit message'
            },
            files: {
              type: 'array',
              items: { type: 'string' },
              description: 'Files to commit (optional, commits all if not specified)'
            }
          },
          required: ['message']
        }
      },
      {
        name: 'git_diff',
        description: 'Show git diff',
        input_schema: {
          type: 'object',
          properties: {
            file: {
              type: 'string',
              description: 'Specific file to show diff for (optional)'
            }
          }
        }
      }
    ];
  }

  getExecutors(): Map<string, ToolExecutor> {
    return new Map([
      ['git_status', new GitStatusExecutor(this.git)],
      ['git_commit', new GitCommitExecutor(this.git)],
      ['git_diff', new GitDiffExecutor(this.git)]
    ]);
  }
}

/**
 * git statusæ‰§è¡Œå™¨
 */
class GitStatusExecutor implements ToolExecutor {
  constructor(private git: SimpleGit) {}

  async execute(): Promise<string> {
    const status = await this.git.status();

    let output = 'Git Status:\n\n';
    output += `Branch: ${status.current}\n`;
    output += `Ahead: ${status.ahead}, Behind: ${status.behind}\n\n`;

    if (status.modified.length > 0) {
      output += 'Modified files:\n';
      status.modified.forEach(file => output += `  - ${file}\n`);
    }

    if (status.not_added.length > 0) {
      output += '\nUntracked files:\n';
      status.not_added.forEach(file => output += `  - ${file}\n`);
    }

    return output;
  }
}

/**
 * git commitæ‰§è¡Œå™¨
 */
class GitCommitExecutor implements ToolExecutor {
  constructor(private git: SimpleGit) {}

  async execute(params: { message: string; files?: string[] }): Promise<string> {
    if (params.files && params.files.length > 0) {
      // æ·»åŠ æŒ‡å®šæ–‡ä»¶
      await this.git.add(params.files);
    } else {
      // æ·»åŠ æ‰€æœ‰æ–‡ä»¶
      await this.git.add('.');
    }

    // æäº¤
    const result = await this.git.commit(params.message);

    return `Committed: ${result.commit}\nSummary: ${result.summary}`;
  }
}

/**
 * git diffæ‰§è¡Œå™¨
 */
class GitDiffExecutor implements ToolExecutor {
  constructor(private git: SimpleGit) {}

  async execute(params?: { file?: string }): Promise<string> {
    const diff = params?.file
      ? await this.git.diff([params.file])
      : await this.git.diff();

    return diff || 'No changes';
  }
}
```

### 5.2 ä¸Šä¸‹æ–‡ä¼˜åŒ–

#### **æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†å™¨**

```typescript
// packages/backend/src/services/context-manager.ts

import { encoding_for_model } from 'tiktoken';
import { Message } from '../types/message';

/**
 * ä¸Šä¸‹æ–‡ä¼˜åŒ–é…ç½®
 */
interface ContextConfig {
  maxTokens: number;
  reserveTokensForResponse: number;
  priorityRules: PriorityRule[];
}

interface PriorityRule {
  type: 'recent' | 'system' | 'important' | 'error';
  weight: number;
}

/**
 * ä¸Šä¸‹æ–‡ç®¡ç†å™¨
 */
export class ContextManager {
  private config: ContextConfig = {
    maxTokens: 200000,
    reserveTokensForResponse: 8000,
    priorityRules: [
      { type: 'system', weight: 10 },
      { type: 'recent', weight: 9 },
      { type: 'error', weight: 8 },
      { type: 'important', weight: 7 }
    ]
  };

  private encoder = encoding_for_model('gpt-4');

  /**
   * ä¼˜åŒ–ä¸Šä¸‹æ–‡
   */
  async optimize(messages: Message[], tokenBudget?: number): Promise<Message[]> {
    const budget = tokenBudget || (this.config.maxTokens - this.config.reserveTokensForResponse);

    // è®¡ç®—å½“å‰tokenæ•°
    let currentTokens = this.countTokens(messages);

    if (currentTokens <= budget) {
      // ä¸éœ€è¦ä¼˜åŒ–
      return messages;
    }

    console.log(`Context optimization needed: ${currentTokens} > ${budget}`);

    // åˆ†ç¦»systemæ¶ˆæ¯
    const systemMessages = messages.filter(m => m.role === 'system');
    const otherMessages = messages.filter(m => m.role !== 'system');

    // ä¿ç•™systemæ¶ˆæ¯
    let optimizedMessages = [...systemMessages];
    let usedTokens = this.countTokens(systemMessages);

    // æŒ‰ä¼˜å…ˆçº§æ’åºå…¶ä»–æ¶ˆæ¯
    const prioritizedMessages = this.prioritizeMessages(otherMessages);

    // è´ªå¿ƒç®—æ³•ï¼šæŒ‰ä¼˜å…ˆçº§æ·»åŠ æ¶ˆæ¯ï¼Œç›´åˆ°è¾¾åˆ°é¢„ç®—
    for (const msg of prioritizedMessages) {
      const msgTokens = this.countTokens([msg]);
      if (usedTokens + msgTokens <= budget) {
        optimizedMessages.push(msg);
        usedTokens += msgTokens;
      } else {
        // å°è¯•æˆªæ–­æ¶ˆæ¯
        const truncated = this.truncateMessage(msg, budget - usedTokens);
        if (truncated) {
          optimizedMessages.push(truncated);
          break;
        }
      }
    }

    // æŒ‰æ—¶é—´é¡ºåºæ’åº
    optimizedMessages.sort((a, b) =>
      new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()
    );

    const finalTokens = this.countTokens(optimizedMessages);
    console.log(`Context optimized: ${currentTokens} -> ${finalTokens} tokens`);

    return optimizedMessages;
  }

  /**
   * è®¡ç®—tokenæ•°
   */
  private countTokens(messages: Message[]): number {
    let total = 0;
    for (const message of messages) {
      const content = typeof message.content === 'string'
        ? message.content
        : JSON.stringify(message.content);
      total += this.encoder.encode(content).length;
    }
    return total;
  }

  /**
   * æŒ‰ä¼˜å…ˆçº§æ’åºæ¶ˆæ¯
   */
  private prioritizeMessages(messages: Message[]): Message[] {
    return messages
      .map(msg => ({
        message: msg,
        priority: this.calculatePriority(msg)
      }))
      .sort((a, b) => b.priority - a.priority)
      .map(item => item.message);
  }

  /**
   * è®¡ç®—æ¶ˆæ¯ä¼˜å…ˆçº§
   */
  private calculatePriority(message: Message): number {
    let priority = 0;

    // æœ€è¿‘çš„æ¶ˆæ¯ä¼˜å…ˆçº§æ›´é«˜
    const age = Date.now() - new Date(message.timestamp).getTime();
    const recencyScore = Math.max(0, 10 - age / (1000 * 60 * 60)); // 1å°æ—¶å†…çš„æ¶ˆæ¯
    priority += recencyScore * 9;

    // åŒ…å«é”™è¯¯ä¿¡æ¯çš„ä¼˜å…ˆçº§æ›´é«˜
    if (message.content.toString().toLowerCase().includes('error')) {
      priority += 8;
    }

    // åŒ…å«é‡è¦å…³é”®è¯çš„ä¼˜å…ˆçº§æ›´é«˜
    const importantKeywords = ['important', 'critical', 'bug', 'fix'];
    for (const keyword of importantKeywords) {
      if (message.content.toString().toLowerCase().includes(keyword)) {
        priority += 7;
        break;
      }
    }

    return priority;
  }

  /**
   * æˆªæ–­æ¶ˆæ¯
   */
  private truncateMessage(message: Message, maxTokens: number): Message | null {
    if (maxTokens < 100) return null; // å¤ªå°‘ï¼Œæ”¾å¼ƒ

    const content = typeof message.content === 'string'
      ? message.content
      : JSON.stringify(message.content);

    const tokens = this.encoder.encode(content);
    if (tokens.length <= maxTokens) {
      return message;
    }

    // æˆªæ–­å¹¶æ·»åŠ çœç•¥æ ‡è®°
    const truncatedTokens = tokens.slice(0, maxTokens - 10);
    const truncatedText = this.encoder.decode(truncatedTokens) + '\n\n...(truncated)';

    return {
      ...message,
      content: truncatedText
    };
  }
}
```

### 5.3 æ€§èƒ½ä¼˜åŒ–

#### **è¯·æ±‚å»é‡å’Œæ‰¹å¤„ç†**

```typescript
// packages/backend/src/services/request-deduplicator.ts

/**
 * è¯·æ±‚å»é‡å™¨
 */
export class RequestDeduplicator {
  private pendingRequests: Map<string, Promise<any>> = new Map();

  /**
   * å»é‡æ‰§è¡Œ
   */
  async deduplicate<T>(key: string, fn: () => Promise<T>): Promise<T> {
    // æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒçš„è¯·æ±‚æ­£åœ¨æ‰§è¡Œ
    if (this.pendingRequests.has(key)) {
      console.log(`Request deduplicated: ${key}`);
      return this.pendingRequests.get(key) as Promise<T>;
    }

    // æ‰§è¡Œæ–°è¯·æ±‚
    const promise = fn().finally(() => {
      // å®Œæˆåç§»é™¤
      this.pendingRequests.delete(key);
    });

    this.pendingRequests.set(key, promise);
    return promise;
  }
}
```

#### **æ™ºèƒ½ç¼“å­˜**

```typescript
// packages/backend/src/services/smart-cache.ts

import { createClient } from 'redis';

/**
 * ç¼“å­˜é…ç½®
 */
interface CacheConfig {
  ttl: number; // ç§’
  maxSize?: number;
}

/**
 * æ™ºèƒ½ç¼“å­˜
 */
export class SmartCache {
  private redis: ReturnType<typeof createClient>;
  private localCache: Map<string, { value: any; expiry: number }> = new Map();

  constructor(redisUrl: string) {
    this.redis = createClient({ url: redisUrl });
    this.redis.connect();

    // å®šæœŸæ¸…ç†æœ¬åœ°ç¼“å­˜
    setInterval(() => this.cleanLocalCache(), 60000);
  }

  /**
   * è·å–ç¼“å­˜
   */
  async get<T>(key: string): Promise<T | null> {
    // å…ˆæŸ¥æœ¬åœ°ç¼“å­˜
    const local = this.localCache.get(key);
    if (local && local.expiry > Date.now()) {
      return local.value;
    }

    // å†æŸ¥Redis
    const value = await this.redis.get(key);
    if (value) {
      const parsed = JSON.parse(value);
      // æ›´æ–°æœ¬åœ°ç¼“å­˜
      this.localCache.set(key, {
        value: parsed,
        expiry: Date.now() + 60000 // æœ¬åœ°ç¼“å­˜1åˆ†é’Ÿ
      });
      return parsed;
    }

    return null;
  }

  /**
   * è®¾ç½®ç¼“å­˜
   */
  async set(key: string, value: any, config: CacheConfig): Promise<void> {
    const serialized = JSON.stringify(value);

    // è®¾ç½®Redisç¼“å­˜
    await this.redis.setEx(key, config.ttl, serialized);

    // è®¾ç½®æœ¬åœ°ç¼“å­˜
    this.localCache.set(key, {
      value,
      expiry: Date.now() + Math.min(config.ttl * 1000, 60000)
    });
  }

  /**
   * åˆ é™¤ç¼“å­˜
   */
  async delete(key: string): Promise<void> {
    await this.redis.del(key);
    this.localCache.delete(key);
  }

  /**
   * æ¸…ç†æœ¬åœ°ç¼“å­˜
   */
  private cleanLocalCache(): void {
    const now = Date.now();
    for (const [key, value] of this.localCache.entries()) {
      if (value.expiry <= now) {
        this.localCache.delete(key);
      }
    }
  }
}
```

---

## 6. éƒ¨ç½²å’Œåˆ†å‘

### 6.1 Dockeréƒ¨ç½²

#### **Dockerfileï¼ˆåç«¯ï¼‰**

```dockerfile
# packages/backend/Dockerfile

FROM node:20-alpine AS builder

WORKDIR /app

# å¤åˆ¶package.json
COPY package.json package-lock.json ./
COPY packages/backend/package.json ./packages/backend/

# å®‰è£…ä¾èµ–
RUN npm ci --workspace=packages/backend

# å¤åˆ¶æºä»£ç 
COPY packages/backend ./packages/backend
COPY packages/shared ./packages/shared

# æ„å»º
WORKDIR /app/packages/backend
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:20-alpine

WORKDIR /app

# åªå¤åˆ¶å¿…è¦æ–‡ä»¶
COPY --from=builder /app/packages/backend/dist ./dist
COPY --from=builder /app/packages/backend/node_modules ./node_modules
COPY --from=builder /app/packages/backend/package.json ./

# è¿è¡Œ
EXPOSE 3000
CMD ["node", "dist/server.js"]
```

#### **Dockerfileï¼ˆå‰ç«¯ï¼‰**

```dockerfile
# packages/frontend/Dockerfile

FROM node:20-alpine AS builder

WORKDIR /app

# å¤åˆ¶package.json
COPY package.json package-lock.json ./
COPY packages/frontend/package.json ./packages/frontend/

# å®‰è£…ä¾èµ–
RUN npm ci --workspace=packages/frontend

# å¤åˆ¶æºä»£ç 
COPY packages/frontend ./packages/frontend
COPY packages/shared ./packages/shared

# æ„å»º
WORKDIR /app/packages/frontend
RUN npm run build

# ç”Ÿäº§é•œåƒï¼ˆNginxï¼‰
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/packages/frontend/dist /usr/share/nginx/html

# å¤åˆ¶Nginxé…ç½®
COPY packages/frontend/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### **docker-compose.yml**

```yaml
version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: aicode
      POSTGRES_PASSWORD: secure_password
      POSTGRES_DB: aicode
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U aicode"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5

  # åç«¯æœåŠ¡
  backend:
    build:
      context: .
      dockerfile: packages/backend/Dockerfile
    environment:
      NODE_ENV: production
      PORT: 3000
      DATABASE_URL: postgresql://aicode:secure_password@postgres:5432/aicode
      REDIS_URL: redis://redis:6379
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      JWT_SECRET: ${JWT_SECRET}
    ports:
      - "3000:3000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    restart: unless-stopped

  # å‰ç«¯æœåŠ¡
  frontend:
    build:
      context: .
      dockerfile: packages/frontend/Dockerfile
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
```

### 6.2 äº‘æœåŠ¡éƒ¨ç½²

#### **AWSéƒ¨ç½²æ¶æ„**

```mermaid
graph TB
    subgraph "ç”¨æˆ·"
        U1[æµè§ˆå™¨]
        U2[CLIå®¢æˆ·ç«¯]
    end

    subgraph "AWS Cloud"
        subgraph "CDNå±‚"
            CF[CloudFront]
        end

        subgraph "è´Ÿè½½å‡è¡¡"
            ALB[Application Load Balancer]
        end

        subgraph "ECS Cluster"
            ECS1[Backend Container 1]
            ECS2[Backend Container 2]
            ECS3[Frontend Container]
        end

        subgraph "æ•°æ®å±‚"
            RDS[(RDS PostgreSQL)]
            REDIS[(ElastiCache Redis)]
            S3[S3 Bucket]
        end

        subgraph "ç›‘æ§"
            CW[CloudWatch]
        end
    end

    U1 --> CF
    U2 --> ALB
    CF --> ALB

    ALB --> ECS1
    ALB --> ECS2
    ALB --> ECS3

    ECS1 --> RDS
    ECS1 --> REDIS
    ECS1 --> S3
    ECS2 --> RDS
    ECS2 --> REDIS
    ECS2 --> S3

    ECS1 --> CW
    ECS2 --> CW
    ECS3 --> CW

    style CF fill:#ff9900
    style RDS fill:#527FFF
    style REDIS fill:#DC382D
```

#### **Kuberneteséƒ¨ç½²æ¸…å•**

```yaml
# k8s/deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-assistant-backend
  labels:
    app: ai-assistant
    component: backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ai-assistant
      component: backend
  template:
    metadata:
      labels:
        app: ai-assistant
        component: backend
    spec:
      containers:
      - name: backend
        image: your-registry/ai-assistant-backend:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: ai-assistant-secrets
              key: database-url
        - name: REDIS_URL
          value: "redis://redis-service:6379"
        - name: ANTHROPIC_API_KEY
          valueFrom:
            secretKeyRef:
              name: ai-assistant-secrets
              key: anthropic-api-key
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "2000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5

---

apiVersion: v1
kind: Service
metadata:
  name: ai-assistant-backend-service
spec:
  selector:
    app: ai-assistant
    component: backend
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer

---

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: ai-assistant-backend-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: ai-assistant-backend
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

### 6.3 æ¡Œé¢åº”ç”¨æ‰“åŒ…

#### **Electronå°è£…**

```typescript
// packages/desktop/src/main.ts

import { app, BrowserWindow, ipcMain } from 'electron';
import path from 'path';
import { spawn } from 'child_process';

let mainWindow: BrowserWindow | null = null;
let backendProcess: any = null;

/**
 * åˆ›å»ºä¸»çª—å£
 */
function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js')
    }
  });

  // åŠ è½½å‰ç«¯
  if (process.env.NODE_ENV === 'development') {
    mainWindow.loadURL('http://localhost:5173');
  } else {
    mainWindow.loadFile(path.join(__dirname, '../frontend/index.html'));
  }

  mainWindow.on('closed', () => {
    mainWindow = null;
  });
}

/**
 * å¯åŠ¨åç«¯æœåŠ¡
 */
function startBackend() {
  const backendPath = path.join(__dirname, '../backend/server.js');

  backendProcess = spawn('node', [backendPath], {
    env: {
      ...process.env,
      PORT: '3001',
      NODE_ENV: 'production'
    }
  });

  backendProcess.stdout.on('data', (data: Buffer) => {
    console.log(`Backend: ${data.toString()}`);
  });

  backendProcess.stderr.on('data', (data: Buffer) => {
    console.error(`Backend Error: ${data.toString()}`);
  });
}

/**
 * åº”ç”¨å¯åŠ¨
 */
app.whenReady().then(() => {
  startBackend();

  // ç­‰å¾…åç«¯å¯åŠ¨
  setTimeout(() => {
    createWindow();
  }, 2000);
});

/**
 * åº”ç”¨é€€å‡º
 */
app.on('window-all-closed', () => {
  if (backendProcess) {
    backendProcess.kill();
  }
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  if (mainWindow === null) {
    createWindow();
  }
});
```

#### **æ‰“åŒ…é…ç½®**

```json
// packages/desktop/package.json

{
  "name": "ai-code-assistant-desktop",
  "version": "1.0.0",
  "main": "dist/main.js",
  "scripts": {
    "start": "electron .",
    "build": "electron-builder"
  },
  "build": {
    "appId": "com.aicode.assistant",
    "productName": "AI Code Assistant",
    "directories": {
      "output": "release"
    },
    "files": [
      "dist/**/*",
      "frontend/**/*",
      "backend/**/*"
    ],
    "mac": {
      "category": "public.app-category.developer-tools",
      "target": ["dmg", "zip"]
    },
    "win": {
      "target": ["nsis", "portable"]
    },
    "linux": {
      "target": ["AppImage", "deb"]
    }
  }
}
```

---

## 7. å•†ä¸šåŒ–æ€è€ƒ

### 7.1 ç›ˆåˆ©æ¨¡å¼

#### **è®¢é˜…åˆ¶ï¼ˆSaaSï¼‰**

```mermaid
graph LR
    A[å…è´¹ç‰ˆ] --> B[åŸºç¡€ç‰ˆ $9/æœˆ]
    B --> C[ä¸“ä¸šç‰ˆ $29/æœˆ]
    C --> D[ä¼ä¸šç‰ˆ å®šåˆ¶]

    A --> A1[åŸºç¡€åŠŸèƒ½<br/>10æ¬¡/å¤©<br/>ç¤¾åŒºæ”¯æŒ]
    B --> B1[å®Œæ•´åŠŸèƒ½<br/>1000æ¬¡/å¤©<br/>é‚®ä»¶æ”¯æŒ]
    C --> C1[é«˜çº§åŠŸèƒ½<br/>æ— é™æ¬¡æ•°<br/>ä¼˜å…ˆæ”¯æŒ]
    D --> D1[ç§æœ‰éƒ¨ç½²<br/>å®šåˆ¶å¼€å‘<br/>ä¸“å±æ”¯æŒ]

    style A fill:#e8f5e9
    style B fill:#fff4e1
    style C fill:#e1f5ff
    style D fill:#ffe1f5
```

**å®šä»·ç­–ç•¥**:

| ç‰ˆæœ¬ | ä»·æ ¼ | åŠŸèƒ½ | ç›®æ ‡ç”¨æˆ· |
|------|------|------|---------|
| **å…è´¹ç‰ˆ** | $0 | åŸºç¡€AIå¯¹è¯<br/>10æ¬¡/å¤©<br/>ç¤¾åŒºæ”¯æŒ | ä¸ªäººå¼€å‘è€…<br/>å­¦ä¹ ä½¿ç”¨ |
| **åŸºç¡€ç‰ˆ** | $9/æœˆ | å®Œæ•´AIåŠŸèƒ½<br/>1000æ¬¡/å¤©<br/>é‚®ä»¶æ”¯æŒ | ç‹¬ç«‹å¼€å‘è€…<br/>å°å›¢é˜Ÿ |
| **ä¸“ä¸šç‰ˆ** | $29/æœˆ | é«˜çº§åŠŸèƒ½<br/>æ— é™æ¬¡æ•°<br/>ä¼˜å…ˆæ”¯æŒ<br/>APIè®¿é—® | ä¸“ä¸šå¼€å‘è€…<br/>æˆé•¿å›¢é˜Ÿ |
| **ä¼ä¸šç‰ˆ** | å®šåˆ¶ | ç§æœ‰éƒ¨ç½²<br/>å®šåˆ¶å¼€å‘<br/>SLAä¿è¯<br/>ä¸“å±å®¢æœ | å¤§å‹ä¼ä¸š<br/>å®‰å…¨æ•æ„Ÿ |

#### **æŒ‰é‡è®¡è´¹**

```typescript
// æˆæœ¬è®¡ç®—å™¨
class PricingCalculator {
  // AIæˆæœ¬ï¼ˆåŸºäºClaude APIï¼‰
  private AI_COST = {
    input: 3 / 1_000_000,   // $3 per M tokens
    output: 15 / 1_000_000  // $15 per M tokens
  };

  // åˆ©æ¶¦ç‡
  private MARKUP = 2.5;

  /**
   * è®¡ç®—ç”¨æˆ·æˆæœ¬
   */
  calculateUserCost(inputTokens: number, outputTokens: number): number {
    const aiCost =
      inputTokens * this.AI_COST.input +
      outputTokens * this.AI_COST.output;

    return aiCost * this.MARKUP;
  }

  /**
   * ç”Ÿæˆå®šä»·æ–¹æ¡ˆ
   */
  generatePricingTiers() {
    return [
      {
        name: 'æŒ‰éœ€ä»˜è´¹',
        price: '$0.01/1K tokens',
        description: 'é€‚åˆå¶å°”ä½¿ç”¨çš„åœºæ™¯'
      },
      {
        name: 'å¥—é¤åŒ…',
        options: [
          { tokens: 1_000_000, price: '$8', savings: '20%' },
          { tokens: 10_000_000, price: '$60', savings: '40%' },
          { tokens: 100_000_000, price: '$400', savings: '60%' }
        ]
      }
    ];
  }
}
```

#### **æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰**

**åŸºç¡€è®¢é˜… + æŒ‰é‡è®¡è´¹ + å¢å€¼æœåŠ¡**:

```
è®¢é˜…è´¹: $19/æœˆ
  â”œâ”€ åŒ…å« 100ä¸‡ tokens/æœˆ
  â”œâ”€ åŸºç¡€åŠŸèƒ½æ— é™ä½¿ç”¨
  â””â”€ æ ‡å‡†æŠ€æœ¯æ”¯æŒ

è¶…é¢ä½¿ç”¨: $0.008/1K tokens

å¢å€¼æœåŠ¡:
  â”œâ”€ è‡ªå®šä¹‰æ¨¡å‹è®­ç»ƒ: $500/æ¬¡
  â”œâ”€ ä¸“å±å·¥å…·å¼€å‘: $1000/ä¸ª
  â”œâ”€ åŸ¹è®­æœåŠ¡: $200/å°æ—¶
  â””â”€ å’¨è¯¢æœåŠ¡: $300/å°æ—¶
```

### 7.2 æˆæœ¬åˆ†æ

#### **è¿è¥æˆæœ¬ä¼°ç®—**

```typescript
/**
 * æœˆåº¦æˆæœ¬è®¡ç®—ï¼ˆ1000ç”¨æˆ·è§„æ¨¡ï¼‰
 */
const MONTHLY_COSTS = {
  // åŸºç¡€è®¾æ–½
  infrastructure: {
    aws_ecs: 500,           // ECS Fargate
    rds_postgres: 200,      // RDS db.t3.large
    elasticache: 100,       // Redis
    s3: 50,                 // å¯¹è±¡å­˜å‚¨
    cloudfront: 100,        // CDN
    subtotal: 950
  },

  // AIæˆæœ¬ï¼ˆå‡è®¾æ¯ç”¨æˆ·æ¯æœˆ100ä¸‡tokensï¼‰
  ai: {
    input_tokens: 1000 * 500_000 * (3 / 1_000_000),   // $1,500
    output_tokens: 1000 * 500_000 * (15 / 1_000_000), // $7,500
    subtotal: 9000
  },

  // äººåŠ›æˆæœ¬
  personnel: {
    developers: 15000,      // 2åå¼€å‘
    support: 5000,          // 1åå®¢æœ
    marketing: 3000,        // è¥é”€
    subtotal: 23000
  },

  // å…¶ä»–
  misc: {
    domain: 20,
    ssl: 0,                 // Let's Encryptå…è´¹
    tools: 200,             // å¼€å‘å·¥å…·è®¢é˜…
    subtotal: 220
  },

  // æ€»è®¡
  total: 33170
};

/**
 * æ”¶å…¥ä¼°ç®—
 */
const MONTHLY_REVENUE = {
  free: 500 * 0,            // 500å…è´¹ç”¨æˆ·
  basic: 300 * 9,           // 300åŸºç¡€ç”¨æˆ· ($9)
  pro: 150 * 29,            // 150ä¸“ä¸šç”¨æˆ· ($29)
  enterprise: 50 * 200,     // 50ä¼ä¸šç”¨æˆ· ($200å¹³å‡)
  total: 0 + 2700 + 4350 + 10000  // $17,050
};

/**
 * ç›ˆåˆ©åˆ†æ
 */
console.log(`
æœˆåº¦æˆæœ¬: $${MONTHLY_COSTS.total}
æœˆåº¦æ”¶å…¥: $${MONTHLY_REVENUE.total}
æœˆåº¦åˆ©æ¶¦: $${MONTHLY_REVENUE.total - MONTHLY_COSTS.total}
åˆ©æ¶¦ç‡: ${((MONTHLY_REVENUE.total - MONTHLY_COSTS.total) / MONTHLY_REVENUE.total * 100).toFixed(2)}%
`);

// è¾“å‡º:
// æœˆåº¦æˆæœ¬: $33,170
// æœˆåº¦æ”¶å…¥: $17,050
// æœˆåº¦åˆ©æ¶¦: -$16,120
// åˆ©æ¶¦ç‡: -94.53%

// ç»“è®º: éœ€è¦è‡³å°‘2000ä¸ªä»˜è´¹ç”¨æˆ·æ‰èƒ½ç›ˆåˆ©
```

#### **ç›ˆäºå¹³è¡¡ç‚¹**

```mermaid
graph LR
    A[ç”¨æˆ·è§„æ¨¡] --> B{ç›ˆäºå¹³è¡¡ç‚¹<br/>çº¦2000ä»˜è´¹ç”¨æˆ·}
    B --> C[æˆæœ¬: $33K/æœˆ]
    B --> D[æ”¶å…¥: $34K/æœˆ]

    C --> C1[å›ºå®šæˆæœ¬: $24K<br/>åŸºç¡€è®¾æ–½+äººåŠ›]
    C --> C2[å˜åŠ¨æˆæœ¬: $9/ç”¨æˆ·<br/>AIæˆæœ¬]

    D --> D1[è®¢é˜…æ”¶å…¥<br/>$15-20/ç”¨æˆ·]
    D --> D2[å¢å€¼æœåŠ¡<br/>$5-10/ç”¨æˆ·]

    style B fill:#ffe1f5
```

**ä¼˜åŒ–ç­–ç•¥**:
1. **é™ä½AIæˆæœ¬**: ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹å¤„ç†ç®€å•ä»»åŠ¡
2. **æé«˜å®¢å•ä»·**: å¢åŠ é«˜ä»·å€¼åŠŸèƒ½,æå‡ä»˜è´¹è½¬åŒ–
3. **è§„æ¨¡æ•ˆåº”**: ç”¨æˆ·å¢é•¿åå›ºå®šæˆæœ¬æ‘Šè–„
4. **è‡ªåŠ¨åŒ–**: å‡å°‘äººå·¥å®¢æœ,æé«˜è¿è¥æ•ˆç‡

### 7.3 å¸‚åœºå®šä½

#### **ç›®æ ‡ç”¨æˆ·ç”»åƒ**

```mermaid
graph TB
    A[ç›®æ ‡ç”¨æˆ·] --> B[ä¸ªäººå¼€å‘è€…]
    A --> C[å°å‹å›¢é˜Ÿ]
    A --> D[ä¼ä¸šå®¢æˆ·]

    B --> B1[ç‰¹å¾:<br/>ç‹¬ç«‹å¼€å‘<br/>é¢„ç®—æœ‰é™<br/>è¿½æ±‚æ•ˆç‡]
    B --> B2[ç—›ç‚¹:<br/>ä»£ç è´¨é‡<br/>é‡å¤å·¥ä½œ<br/>æŠ€æœ¯å€ºåŠ¡]
    B --> B3[ä»·å€¼:<br/>æå‡æ•ˆç‡<br/>å­¦ä¹ æ–°æŠ€æœ¯<br/>ä»£ç è´¨é‡]

    C --> C1[ç‰¹å¾:<br/>5-20äºº<br/>å¿«é€Ÿè¿­ä»£<br/>æˆæœ¬æ•æ„Ÿ]
    C --> C2[ç—›ç‚¹:<br/>åä½œæ•ˆç‡<br/>ä»£ç è§„èŒƒ<br/>çŸ¥è¯†ä¼ æ‰¿]
    C --> C3[ä»·å€¼:<br/>å›¢é˜Ÿåä½œ<br/>è´¨é‡ä¿è¯<br/>é™ä½æˆæœ¬]

    D --> D1[ç‰¹å¾:<br/>50+äºº<br/>å®‰å…¨ä¸ºå…ˆ<br/>å®šåˆ¶éœ€æ±‚]
    D --> D2[ç—›ç‚¹:<br/>æ•°æ®å®‰å…¨<br/>åˆè§„è¦æ±‚<br/>ç³»ç»Ÿé›†æˆ]
    D --> D3[ä»·å€¼:<br/>ç§æœ‰éƒ¨ç½²<br/>å®šåˆ¶å¼€å‘<br/>å®‰å…¨ä¿éšœ]

    style A fill:#e1f5ff
```

#### **ç«äº‰åˆ†æ**

| äº§å“ | å®šä½ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æˆ‘ä»¬çš„å·®å¼‚åŒ– |
|------|------|------|------|-------------|
| **GitHub Copilot** | IDEæ’ä»¶ | âœ…å¾®è½¯èƒŒä¹¦<br/>âœ…IDEé›†æˆæ·± | âš ï¸ä»…ä»£ç è¡¥å…¨<br/>âš ï¸ä¸æ”¯æŒä»»åŠ¡æ‰§è¡Œ | ğŸš€å®Œæ•´çš„AI Agent<br/>ğŸš€è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ |
| **Cursor** | AIç¼–è¾‘å™¨ | âœ…ç‹¬ç«‹ç¼–è¾‘å™¨<br/>âœ…ä½“éªŒå¥½ | âš ï¸ç»‘å®šç¼–è¾‘å™¨<br/>âš ï¸å°é—­ç”Ÿæ€ | ğŸš€è·¨ç¼–è¾‘å™¨<br/>ğŸš€å¼€æ”¾æ’ä»¶ç³»ç»Ÿ |
| **Claude Code** | CLIå·¥å…· | âœ…å¼ºå¤§çš„AI<br/>âœ…å·¥å…·è°ƒç”¨ | âš ï¸ä»…CLI<br/>âš ï¸ä¸æ”¯æŒå¤šç”¨æˆ· | ğŸš€Web UI<br/>ğŸš€å›¢é˜Ÿåä½œ<br/>ğŸš€äº‘ç«¯éƒ¨ç½² |
| **Cody** | å¤šç«¯æ”¯æŒ | âœ…æ”¯æŒå¤šIDE<br/>âœ…ä¼ä¸šåŠŸèƒ½ | âš ï¸é…ç½®å¤æ‚<br/>âš ï¸ä»·æ ¼è¾ƒé«˜ | ğŸš€æ˜“ç”¨æ€§<br/>ğŸš€çµæ´»å®šä»· |

**æˆ‘ä»¬çš„æ ¸å¿ƒç«äº‰åŠ›**:
1. ğŸ¯ **å¤šç«¯æ”¯æŒ**: Web + CLI + VS Code + IDEé›†æˆ
2. ğŸ¯ **å¼€æ”¾ç”Ÿæ€**: æ’ä»¶ç³»ç»Ÿã€MCPåè®®
3. ğŸ¯ **çµæ´»éƒ¨ç½²**: äº‘ç«¯SaaS + ç§æœ‰éƒ¨ç½²
4. ğŸ¯ **åˆç†å®šä»·**: ä»å…è´¹åˆ°ä¼ä¸šç‰ˆçš„å®Œæ•´æ–¹æ¡ˆ

---

## 8. æœ€ä½³å®è·µ

### 8.1 å¼€å‘æœ€ä½³å®è·µ

**ä»£ç ç»„ç»‡**:
```
âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œå•ä¸€èŒè´£
âœ… TypeScriptä¸¥æ ¼æ¨¡å¼
âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
âœ… å®Œå–„çš„æ—¥å¿—è®°å½•
âœ… ä»£ç å¤ç”¨ï¼ˆsharedåŒ…ï¼‰
```

**æµ‹è¯•ç­–ç•¥**:
```
âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
âœ… é›†æˆæµ‹è¯•å…³é”®æµç¨‹
âœ… E2Eæµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
âœ… å‹åŠ›æµ‹è¯•æ€§èƒ½ç“¶é¢ˆ
âœ… å®‰å…¨æµ‹è¯•æ¼æ´æ‰«æ
```

**æ€§èƒ½ä¼˜åŒ–**:
```
âœ… ä½¿ç”¨ç¼“å­˜å‡å°‘AIè°ƒç”¨
âœ… å¹¶å‘å¤„ç†ç‹¬ç«‹ä»»åŠ¡
âœ… æµå¼å“åº”æå‡ä½“éªŒ
âœ… CDNåŠ é€Ÿé™æ€èµ„æº
âœ… æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
```

### 8.2 è¿è¥æœ€ä½³å®è·µ

**ç›‘æ§å‘Šè­¦**:
```typescript
// å…³é”®æŒ‡æ ‡ç›‘æ§
const METRICS = {
  // ä¸šåŠ¡æŒ‡æ ‡
  business: [
    'daily_active_users',
    'new_signups',
    'churn_rate',
    'revenue'
  ],

  // æŠ€æœ¯æŒ‡æ ‡
  technical: [
    'api_response_time',
    'error_rate',
    'ai_token_usage',
    'database_connections'
  ],

  // æˆæœ¬æŒ‡æ ‡
  cost: [
    'ai_api_cost',
    'infrastructure_cost',
    'cost_per_user'
  ]
};
```

**ç”¨æˆ·åé¦ˆ**:
```
âœ… å†…ç½®åé¦ˆæŒ‰é’®
âœ… å®šæœŸç”¨æˆ·è°ƒç ”
âœ… æ•°æ®åˆ†æé©±åŠ¨
âœ… å¿«é€Ÿè¿­ä»£æ”¹è¿›
```

### 8.3 å®‰å…¨æœ€ä½³å®è·µ

**å¤šå±‚é˜²æŠ¤**:
```mermaid
graph TB
    A[å®‰å…¨é˜²æŠ¤] --> B[ç½‘ç»œå±‚]
    A --> C[åº”ç”¨å±‚]
    A --> D[æ•°æ®å±‚]

    B --> B1[HTTPSå¼ºåˆ¶]
    B --> B2[DDoSé˜²æŠ¤]
    B --> B3[WAFé˜²ç«å¢™]

    C --> C1[èº«ä»½è®¤è¯]
    C --> C2[æƒé™æ§åˆ¶]
    C --> C3[é™æµé˜²æŠ¤]
    C --> C4[è¾“å…¥éªŒè¯]

    D --> D1[æ•°æ®åŠ å¯†]
    D --> D2[è®¿é—®å®¡è®¡]
    D --> D3[å¤‡ä»½æ¢å¤]

    style A fill:#ffe1e1
```

---

## 9. FAQ

### Q1: å¦‚ä½•é€‰æ‹©AIæ¨¡å‹ï¼Ÿ

**A**: æ ¹æ®åœºæ™¯é€‰æ‹©ï¼š
- **ä¸»åŠ›åœºæ™¯**: Claude 3.5 Sonnetï¼ˆæœ€ä½³å¹³è¡¡ï¼‰
- **æˆæœ¬æ•æ„Ÿ**: Deepseek Coderï¼ˆä¾¿å®œ75%ï¼‰
- **ç§æœ‰éƒ¨ç½²**: Ollama + CodeLlamaï¼ˆå®Œå…¨ç¦»çº¿ï¼‰
- **å¤æ‚ä»»åŠ¡**: GPT-4 Turboï¼ˆèƒ½åŠ›æœ€å¼ºï¼‰

å»ºè®®å®ç°æ¨¡å‹åˆ‡æ¢åŠŸèƒ½ï¼Œè®©ç”¨æˆ·æ ¹æ®éœ€æ±‚é€‰æ‹©ã€‚

### Q2: å¦‚ä½•æ§åˆ¶AIæˆæœ¬ï¼Ÿ

**A**: å¤šæ–¹é¢ä¼˜åŒ–ï¼š
1. **æ™ºèƒ½ç¼“å­˜**: ç›¸åŒé—®é¢˜ä¸é‡å¤è°ƒç”¨
2. **ä¸Šä¸‹æ–‡ä¼˜åŒ–**: å‡å°‘æ— ç”¨token
3. **æ¨¡å‹åˆ†çº§**: ç®€å•ä»»åŠ¡ç”¨ä¾¿å®œæ¨¡å‹
4. **æ‰¹é‡å¤„ç†**: åˆå¹¶å¤šä¸ªå°è¯·æ±‚
5. **ç”¨æˆ·é™åˆ¶**: é™åˆ¶å…è´¹ç”¨æˆ·è°ƒç”¨é¢‘ç‡

### Q3: å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ

**A**: å‚è€ƒç¬¬15ç¯‡ã€Šå®‰å…¨æœºåˆ¶è®¾è®¡ã€‹ï¼š
- âœ… æ‰€æœ‰æ•°æ®åŠ å¯†å­˜å‚¨
- âœ… HTTPSå¼ºåˆ¶ä¼ è¾“
- âœ… ä¸¥æ ¼çš„æƒé™æ§åˆ¶
- âœ… æ•æ„Ÿæ“ä½œå®¡è®¡æ—¥å¿—
- âœ… æ”¯æŒç§æœ‰éƒ¨ç½²ï¼ˆä¼ä¸šç‰ˆï¼‰

### Q4: å¦‚ä½•æé«˜å“åº”é€Ÿåº¦ï¼Ÿ

**A**:
1. **æµå¼å“åº”**: è¾¹ç”Ÿæˆè¾¹å±•ç¤º
2. **æ™ºèƒ½ç¼“å­˜**: ç¼“å­˜å¸¸è§æŸ¥è¯¢
3. **å¹¶å‘å¤„ç†**: å·¥å…·å¹¶è¡Œæ‰§è¡Œ
4. **CDNåŠ é€Ÿ**: é™æ€èµ„æºåˆ†å‘
5. **æ•°æ®åº“ä¼˜åŒ–**: ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–

### Q5: å¦‚ä½•æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Ÿ

**A**:
- **æ–¹æ¡ˆ1**: æ¡Œé¢åº”ç”¨ + æœ¬åœ°AIæ¨¡å‹ï¼ˆOllamaï¼‰
- **æ–¹æ¡ˆ2**: PWA + Service Workerç¼“å­˜
- **æ–¹æ¡ˆ3**: æ··åˆæ¨¡å¼ï¼ˆåœ¨çº¿ä¼˜å…ˆï¼Œç¦»çº¿é™çº§ï¼‰

---

## 10. æ€»ç»“å’Œå±•æœ›

### 10.1 ç³»åˆ—æ€»ç»“

é€šè¿‡è¿™20ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å®Œæ•´åœ°è®²è§£äº†AIç¼–ç¨‹åŠ©æ‰‹çš„æ–¹æ–¹é¢é¢ï¼š

**ç†è®ºç¯‡** âœ…
- æ¶æ„è®¾è®¡åŸç†
- æ ¸å¿ƒæŠ€æœ¯é€‰å‹
- ç³»ç»Ÿè®¾è®¡æ¨¡å¼

**å®ç°ç¯‡** âœ…
- æ ¸å¿ƒå¼•æ“å®ç°
- å·¥å…·ç³»ç»Ÿå¼€å‘
- åè®®å’Œé›†æˆ

**å·¥ç¨‹ç¯‡** âœ…
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- å®‰å…¨æœºåˆ¶è®¾è®¡
- æµ‹è¯•å’Œéƒ¨ç½²

**å®æˆ˜ç¯‡** âœ…
- å®Œæ•´MVPä»£ç 
- å•†ä¸šåŒ–æ€è€ƒ
- æœ€ä½³å®è·µ

### 10.2 æ ¸å¿ƒè¦ç‚¹å›é¡¾

**æ¶æ„è®¾è®¡**:
```
âœ… åˆ†å±‚æ¸…æ™°ï¼šäº¤äº’-å¼•æ“-å·¥å…·-ç³»ç»Ÿ
âœ… æ¨¡å—åŒ–ï¼šæ¾è€¦åˆã€é«˜å†…èš
âœ… å¯æ‰©å±•ï¼šæ’ä»¶ç³»ç»Ÿã€MCPåè®®
âœ… é«˜æ€§èƒ½ï¼šç¼“å­˜ã€å¹¶å‘ã€æµå¼
```

**æŠ€æœ¯é€‰å‹**:
```
âœ… å‰ç«¯ï¼šReact + TypeScript + Zustand
âœ… åç«¯ï¼šNode.js + Express + Socket.IO
âœ… AIï¼šClaude 3.5 Sonnetï¼ˆå¯åˆ‡æ¢ï¼‰
âœ… æ•°æ®ï¼šPostgreSQL + Redis + S3
```

**å•†ä¸šæ¨¡å¼**:
```
âœ… è®¢é˜…åˆ¶ä¸ºä¸»ï¼ŒæŒ‰é‡è®¡è´¹ä¸ºè¾…
âœ… å…è´¹-åŸºç¡€-ä¸“ä¸š-ä¼ä¸š å››çº§å®šä»·
âœ… å¢å€¼æœåŠ¡ï¼ˆå®šåˆ¶ã€åŸ¹è®­ã€å’¨è¯¢ï¼‰
âœ… ç›ˆäºå¹³è¡¡ç‚¹çº¦2000ä»˜è´¹ç”¨æˆ·
```

### 10.3 åç»­å‘å±•æ–¹å‘

#### **çŸ­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰**
- ğŸ¯ å®Œå–„MVPåŠŸèƒ½
- ğŸ¯ æ”¶é›†ç”¨æˆ·åé¦ˆ
- ğŸ¯ ä¼˜åŒ–æ ¸å¿ƒä½“éªŒ
- ğŸ¯ å»ºç«‹ç¤¾åŒº

#### **ä¸­æœŸï¼ˆ6-12ä¸ªæœˆï¼‰**
- ğŸ¯ å¢åŠ é«˜çº§åŠŸèƒ½ï¼ˆå›¢é˜Ÿåä½œã€ä»£ç å®¡æŸ¥ï¼‰
- ğŸ¯ æ”¯æŒæ›´å¤šIDEé›†æˆ
- ğŸ¯ å¼€å‘ç§»åŠ¨ç«¯åº”ç”¨
- ğŸ¯ æ‹“å±•æ’ä»¶ç”Ÿæ€

#### **é•¿æœŸï¼ˆ1å¹´+ï¼‰**
- ğŸ¯ ä¼ä¸šçº§åŠŸèƒ½ï¼ˆç§æœ‰éƒ¨ç½²ã€SSOï¼‰
- ğŸ¯ è‡ªè®­ç»ƒæ¨¡å‹ï¼ˆé¢†åŸŸç‰¹åŒ–ï¼‰
- ğŸ¯ AI Agent Marketplace
- ğŸ¯ å¼€æºæ ¸å¿ƒç»„ä»¶

### 10.4 æŠ€æœ¯è¶‹åŠ¿

**AIç¼–ç¨‹åŠ©æ‰‹çš„æœªæ¥**:

```mermaid
graph LR
    A[2025 ç°åœ¨] --> B[2026 è¿‘æœŸ]
    B --> C[2027 ä¸­æœŸ]
    C --> D[2028+ è¿œæœŸ]

    A --> A1[ä»£ç è¡¥å…¨<br/>ç®€å•å¯¹è¯<br/>å·¥å…·è°ƒç”¨]
    B --> B1[ä»»åŠ¡è‡ªåŠ¨åŒ–<br/>å¤šæ¨¡æ€äº¤äº’<br/>å›¢é˜Ÿåä½œ]
    C --> C1[è‡ªä¸»Agent<br/>ç«¯åˆ°ç«¯å¼€å‘<br/>è‡ªæˆ‘è¿›åŒ–]
    D --> D1[å®Œå…¨è‡ªä¸»<br/>æ›¿ä»£å¼€å‘è€…?<br/>æ–°çš„èŒƒå¼]

    style A fill:#e8f5e9
    style B fill:#fff4e1
    style C fill:#e1f5ff
    style D fill:#ffe1f5
```

**å…³é”®æŠ€æœ¯æ–¹å‘**:
1. **æ›´å¼ºçš„æ¨ç†èƒ½åŠ›**: Claude 4ã€GPT-5
2. **æ›´é•¿çš„ä¸Šä¸‹æ–‡**: 100ä¸‡+ tokens
3. **æ›´å¿«çš„å“åº”**: å®æ—¶äº¤äº’ä½“éªŒ
4. **æ›´ä½çš„æˆæœ¬**: æˆæœ¬é™ä½10å€+
5. **æ›´å¥½çš„å®‰å…¨**: ä»£ç å®‰å…¨æ‰«æã€æ¼æ´æ£€æµ‹

### 10.5 ç»“æŸè¯­

æ­å–œä½ å®Œæˆäº†è¿™ä¸ªç³»åˆ—çš„å­¦ä¹ ï¼ğŸ‰

ç°åœ¨ä½ å·²ç»æŒæ¡äº†ï¼š
- âœ… å¦‚ä½•è®¾è®¡ä¸€ä¸ªAIç¼–ç¨‹åŠ©æ‰‹çš„å®Œæ•´æ¶æ„
- âœ… å¦‚ä½•å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼ˆä»AIå¼•æ“åˆ°å·¥å…·ç³»ç»Ÿï¼‰
- âœ… å¦‚ä½•ä¼˜åŒ–æ€§èƒ½å’Œä¿è¯å®‰å…¨
- âœ… å¦‚ä½•éƒ¨ç½²ä¸Šçº¿å’Œå•†ä¸šåŒ–è¿è¥

**æ¥ä¸‹æ¥çš„è¡ŒåŠ¨**:
1. ğŸ“ åŠ¨æ‰‹å®ç°MVPï¼ˆè·Ÿç€ä»£ç ä¸€æ­¥æ­¥åšï¼‰
2. ğŸš€ éƒ¨ç½²åˆ°äº‘ç«¯ï¼ˆå…ˆä»Dockerå¼€å§‹ï¼‰
3. ğŸ‘¥ é‚€è¯·æœ‹å‹è¯•ç”¨ï¼ˆæ”¶é›†åé¦ˆï¼‰
4. ğŸ’¡ è¿­ä»£ä¼˜åŒ–ï¼ˆæŒç»­æ”¹è¿›ï¼‰
5. ğŸ’° æ¢ç´¢å•†ä¸šåŒ–ï¼ˆå¦‚æœæ•ˆæœå¥½ï¼‰

**è®°ä½**:
> "æœ€å¥½çš„å­¦ä¹ æ–¹å¼å°±æ˜¯åŠ¨æ‰‹å®è·µã€‚"

ä¸è¦è¢«å®Œç¾ä¸»ä¹‰å›°ä½ï¼Œå…ˆåšå‡ºæ¥ï¼Œå†æ…¢æ…¢ä¼˜åŒ–ã€‚

**ä¿æŒè”ç³»**:
- ğŸŒŸ GitHub: [é¡¹ç›®åœ°å€]
- ğŸ’¬ Discord: [ç¤¾åŒºé“¾æ¥]
- ğŸ“§ Email: [è”ç³»é‚®ç®±]
- ğŸ¦ Twitter: [æ¨ç‰¹è´¦å·]

æœŸå¾…çœ‹åˆ°ä½ æ„å»ºå‡ºè‡ªå·±çš„AIç¼–ç¨‹åŠ©æ‰‹ï¼ğŸš€

---

## æ‰©å±•é˜…è¯»

**å®˜æ–¹æ–‡æ¡£**:
- [Anthropic APIæ–‡æ¡£](https://docs.anthropic.com/)
- [OpenAI APIæ–‡æ¡£](https://platform.openai.com/docs)
- [MCPåè®®è§„èŒƒ](https://modelcontextprotocol.io/)

**å¼€æºé¡¹ç›®**:
- [Claude Code](https://docs.claude.com/claude-code)
- [Continue.dev](https://github.com/continuedev/continue)
- [Aider](https://github.com/paul-gauthier/aider)

**å­¦ä¹ èµ„æº**:
- [LangChainæ–‡æ¡£](https://docs.langchain.com/)
- [AI Agentè®¾è®¡æ¨¡å¼](https://www.deeplearning.ai/short-courses/ai-agents-in-langgraph/)
- [Promptå·¥ç¨‹æŒ‡å—](https://www.promptingguide.ai/)

**å•†ä¸šåˆ†æ**:
- [AIå¼€å‘å·¥å…·å¸‚åœºæŠ¥å‘Š](https://www.forrester.com/)
- [GitHub Copilotæ¡ˆä¾‹ç ”ç©¶](https://github.blog/)
- [AIç¼–ç¨‹åŠ©æ‰‹ç”¨æˆ·è°ƒç ”](https://stackoverflow.blog/)

---

**ä½œè€…**: Claude Codeæ¶æ„ç³»åˆ—
**ç³»åˆ—å®Œç»“**: 2025-01-14
**æ€»å­—æ•°**: çº¦120,000å­—
**æ€»ä»£ç è¡Œæ•°**: çº¦15,000è¡Œ

**æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼** â¤ï¸

å¦‚æœè¿™ä¸ªç³»åˆ—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ï¼š
- â­ Staré¡¹ç›®
- ğŸ”„ åˆ†äº«ç»™æœ‹å‹
- ğŸ’¬ åŠ å…¥ç¤¾åŒºè®¨è®º
- ğŸ› æäº¤é—®é¢˜å’Œå»ºè®®

**è®©æˆ‘ä»¬ä¸€èµ·æ¨åŠ¨AIç¼–ç¨‹å·¥å…·çš„å‘å±•ï¼** ğŸš€
